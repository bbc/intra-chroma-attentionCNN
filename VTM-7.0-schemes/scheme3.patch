diff --git a/source/Lib/CommonLib/CommonDef.h b/source/Lib/CommonLib/CommonDef.h
index 1732b46..44612e8 100644
--- a/source/Lib/CommonLib/CommonDef.h
+++ b/source/Lib/CommonLib/CommonDef.h
@@ -232,7 +232,11 @@ static const int MULTI_REF_LINE_IDX[4] =               { 0, 1, 3, 0 };
 static const int PRED_REG_MIN_WIDTH =                               4;  // Minimum prediction region width for ISP subblocks
 
 static const int NUM_LUMA_MODE =                                   67; ///< Planar + DC + 65 directional mode (4*16 + 1)
+#if NN_CHROMA_PRED_SIGNAL
+static const int NUM_LMC_MODE = 1 + 3; ///< LMC + MDLM_T + MDLM_L
+#else
 static const int NUM_LMC_MODE =                                    1 + 2; ///< LMC + MDLM_T + MDLM_L
+#endif
 static const int NUM_INTRA_MODE = (NUM_LUMA_MODE + NUM_LMC_MODE);
 
 static const int NUM_EXT_LUMA_MODE =                               28;
@@ -251,6 +255,9 @@ static const int NUM_CHROMA_MODE = (5 + NUM_LMC_MODE); ///< total number of chro
 static const int LM_CHROMA_IDX = NUM_LUMA_MODE; ///< chroma mode index for derived from LM mode
 static const int MDLM_L_IDX =                          LM_CHROMA_IDX + 1; ///< MDLM_L
 static const int MDLM_T_IDX =                          LM_CHROMA_IDX + 2; ///< MDLM_T
+#if NN_CHROMA_PRED_SIGNAL
+static const int LM_CHROMA_NN =                        LM_CHROMA_IDX + 3; ///< LM_CHROMA_NN
+#endif
 static const int DM_CHROMA_IDX =                       NUM_INTRA_MODE; ///< chroma mode index for derived from luma intra mode
 
 static const uint32_t  NUM_TRAFO_MODES_MTS =                            6; ///< Max Intra CU size applying EMT, supported values: 8, 16, 32, 64, 128
@@ -516,6 +523,9 @@ struct ClpRngs
 template <typename T> inline T Clip3 (const T minVal, const T maxVal, const T a) { return std::min<T> (std::max<T> (minVal, a) , maxVal); }  ///< general min/max clip
 template <typename T> inline T ClipBD( const T x, const int bitDepth ) { return Clip3( T( 0 ), T( ( 1 << bitDepth ) - 1 ), x ); }
 template <typename T> inline T ClipPel (const T a, const ClpRng& clpRng)         { return std::min<T> (std::max<T> (clpRng.min, a) , clpRng.max); }  ///< clip reconstruction
+#if NN_CHROMA_PRED
+inline long RELU(long a) { return a > 0 ? a : 0; }
+#endif 
 
 template <typename T> inline void Check3( T minVal, T maxVal, T a)
 {
diff --git a/source/Lib/CommonLib/Contexts.cpp b/source/Lib/CommonLib/Contexts.cpp
index 3280c08..1f95cc1 100755
--- a/source/Lib/CommonLib/Contexts.cpp
+++ b/source/Lib/CommonLib/Contexts.cpp
@@ -322,6 +322,15 @@ const CtxSet ContextSetCfg::CclmModeFlag = ContextSetCfg::addCtxSet
   {   4, },
 });
 
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+const CtxSet ContextSetCfg::CclmNnModeFlag = ContextSetCfg::addCtxSet
+({
+  { 26, },
+  { 34, },
+  { 59, },
+  { 4, },
+  });
+#endif
 #if JVET_P0615_CHROMAMODE_CLEANUP
 const CtxSet ContextSetCfg::CclmModeIdx = ContextSetCfg::addCtxSet
 ({
diff --git a/source/Lib/CommonLib/Contexts.h b/source/Lib/CommonLib/Contexts.h
index 519f6ac..a905886 100644
--- a/source/Lib/CommonLib/Contexts.h
+++ b/source/Lib/CommonLib/Contexts.h
@@ -208,6 +208,9 @@ public:
   static const CtxSet   IntraLumaMpmFlag;
   static const CtxSet   IntraLumaPlanarFlag;
   static const CtxSet   CclmModeFlag;
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+  static const CtxSet   CclmNnModeFlag;
+#endif
 #if JVET_P0615_CHROMAMODE_CLEANUP
   static const CtxSet   CclmModeIdx;
 #endif
diff --git a/source/Lib/CommonLib/IntraPrediction.cpp b/source/Lib/CommonLib/IntraPrediction.cpp
index ad24b54..8d8ebc3 100644
--- a/source/Lib/CommonLib/IntraPrediction.cpp
+++ b/source/Lib/CommonLib/IntraPrediction.cpp
@@ -1417,7 +1417,18 @@ void IntraPrediction::xGetLumaRecPixels(const PredictionUnit &pu, CompArea chrom
   int iDstStride = 0;
   Pel* pDst0 = 0;
   int curChromaMode = pu.intraDir[1];
+#if NN_CHROMA_PRED && !NN_CHROMA_PRED_SIGNAL
+  if (curChromaMode == LM_CHROMA_IDX && ((chromaArea.width == 4 && chromaArea.height == 4) || (chromaArea.width == 8 && chromaArea.height == 8) || (chromaArea.width == 16 && chromaArea.height == 16)))
+  {
+    curChromaMode = MDLM_L_IDX;
+  }
+#endif
+
+#if NN_CHROMA_PRED_SIGNAL
+  if ((curChromaMode == LM_CHROMA_NN) || (curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#else
   if ((curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#endif
   {
     iDstStride = 2 * MAX_CU_SIZE + 1;
     pDst0 = m_pMdlmTemp + iDstStride + 1;
@@ -1535,7 +1546,11 @@ void IntraPrediction::xGetLumaRecPixels(const PredictionUnit &pu, CompArea chrom
   {
     pDst  = pDst0    - iDstStride;
     int addedAboveRight = 0;
+#if NN_CHROMA_PRED_SIGNAL
+    if ((curChromaMode == LM_CHROMA_NN) || (curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#else
     if ((curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#endif
     {
       addedAboveRight = avaiAboveRightUnits*chromaUnitWidth;
     }
@@ -1595,7 +1610,11 @@ void IntraPrediction::xGetLumaRecPixels(const PredictionUnit &pu, CompArea chrom
     piSrc = pRecSrc0 - 2 - logSubWidthC;
 
     int addedLeftBelow = 0;
+#if NN_CHROMA_PRED_SIGNAL
+    if ((curChromaMode == LM_CHROMA_NN) || (curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#else
     if ((curChromaMode == MDLM_L_IDX) || (curChromaMode == MDLM_T_IDX))
+#endif
     {
       addedLeftBelow = avaiLeftBelowUnits*chromaUnitHeight;
     }
@@ -1628,6 +1647,33 @@ void IntraPrediction::xGetLumaRecPixels(const PredictionUnit &pu, CompArea chrom
     }
   }
 
+#if NN_CHROMA_PRED
+  // recover LT references for NN chroma prediction
+#if NN_CHROMA_PRED_SIGNAL
+  if ((curChromaMode == LM_CHROMA_NN) &&  bAboveAvaillable && bLeftAvaillable)
+#else
+  if (bAboveAvaillable && bLeftAvaillable)
+#endif
+  {
+    pDst = pDst0 - 1 - iDstStride;
+
+    piSrc = pRecSrc0 - 2 - logSubWidthC - iRecStride2;
+
+    if (pu.cs->sps->getCclmCollocatedChromaFlag())
+    {
+      pDst[0] = (piSrc[1 - strOffset] * c0_5tap
+        + piSrc[1] * c1_5tap + piSrc[0] * c2_5tap + piSrc[2] * c3_5tap
+        + piSrc[1 + strOffset] * c4_5tap
+        + offset_5tap) >> shift_5tap;
+    }
+    else 
+    {
+      pDst[0] = ((piSrc[1] * c0_6tap + piSrc[0] * c1_6tap + piSrc[2] * c2_6tap)
+        + (piSrc[1 + strOffset] * c3_6tap + piSrc[strOffset] * c4_6tap + piSrc[2 + strOffset] * c5_6tap)
+        + offset_6tap) >> shift_6tap;
+    }
+  }
+#endif
   // inner part from reconstructed picture buffer
   for( int j = 0; j < uiCHeight; j++ )
   {
@@ -1969,6 +2015,72 @@ void IntraPrediction::predIntraMip( const ComponentID compId, PelBuf &piPred, co
   }
 #endif
 }
+#if NN_CHROMA_PRED
+void IntraPrediction::initNNIntraChroma(const PredictionUnit &pu, const CompArea& area)
+{
+  Pel *ptrSrcCb = getPredictorPtr(COMPONENT_Cb);
+  Pel *ptrSrcCr = getPredictorPtr(COMPONENT_Cr);
+
+  const int srcStride = 2 * MAX_CU_SIZE + 1;
+  
+  // Compute availability
+  const CodingUnit &cu = *(pu.cu);
+  const Position posLT = area;
+
+  int leftUnits = 2 * area.height;
+  int aboveUnits = 2 * area.width;
+  int totalUnits = leftUnits + aboveUnits;
+
+  bool neighborFlags[4 * MAX_NUM_PART_IDXS_IN_CTU_WIDTH + 1];
+  memset(neighborFlags, 0, totalUnits);
+
+  int availableAbove =
+    isAboveAvailable(cu, CHANNEL_TYPE_CHROMA, posLT, aboveUnits, 1,
+    (neighborFlags + leftUnits + 1));
+
+  int availableLeft =
+    isLeftAvailable(cu, CHANNEL_TYPE_CHROMA, posLT, leftUnits, 1,
+    (neighborFlags + leftUnits - 1));
+
+  const int availableRefs[2] = {availableAbove, availableLeft};
+
+  PelBuf pColY = PelBuf(m_pMdlmTemp + srcStride + 1, srcStride, Size(area));
+
+  m_NNIntraChromaPred.prepareInputForPred(ptrSrcCb, ptrSrcCr, pColY,
+    area, m_refBufferStride, availableRefs, pu.cu->slice->getSPS()->getBitDepth(CHANNEL_TYPE_LUMA));
+}
+
+
+void IntraPrediction::predIntraNN(PelBuf &piPredCb, PelBuf &piPredCr, const PredictionUnit &pu, ComponentID compID, const ClpRng& clpRng)
+{
+  static_vector<int16_t, MIP_MAX_WIDTH * MIP_MAX_HEIGHT> predNNCb(piPredCb.width * piPredCb.height);
+  static_vector<int16_t, MIP_MAX_WIDTH * MIP_MAX_HEIGHT> predNNCr(piPredCb.width * piPredCb.height);
+  m_NNIntraChromaPred.predBlock(predNNCb.data(), predNNCr.data());
+  
+  // Update both components if compID == COMPONENT_Y (default case)
+
+  if (compID != COMPONENT_Cr)
+  {
+    for (int y = 0; y < piPredCb.height; y++)
+    {
+      for (int x = 0; x < piPredCb.width; x++)
+      {
+        piPredCb.at(x, y) = ClipPel(Pel(predNNCb[y * piPredCb.width + x]), clpRng);
+      }
+    }
+  }
+  if (compID != COMPONENT_Cb)
+  {
+    for (int y = 0; y < piPredCr.height; y++)
+    {
+      for (int x = 0; x < piPredCr.width; x++)
+      {
+        piPredCr.at(x, y) = ClipPel(Pel(predNNCr[y * piPredCr.width + x]), clpRng);
+      }
+    }
+  }
+}
+#endif
 #if !JVET_P0077_LINE_CG_PALETTE
 bool IntraPrediction::calCopyRun(CodingStructure &cs, Partitioner& partitioner, uint32_t startPos, uint32_t total, uint32_t &run, ComponentID compBegin)
 {
diff --git a/source/Lib/CommonLib/IntraPrediction.h b/source/Lib/CommonLib/IntraPrediction.h
index d96b8f0..7f7e69d 100644
--- a/source/Lib/CommonLib/IntraPrediction.h
+++ b/source/Lib/CommonLib/IntraPrediction.h
@@ -45,6 +45,7 @@
 #include "Picture.h"
 
 #include "MatrixIntraPrediction.h"
+#include "NNIntraChromaPrediction.h"
 
 //! \ingroup CommonLib
 //! \{
@@ -109,6 +110,9 @@ private:
   MatrixIntraPrediction m_matrixIntraPred;
 
 
+#if NN_CHROMA_PRED
+  NNIntraChromaPrediction m_NNIntraChromaPred;
+#endif
 
 protected:
   ChromaFormat  m_currChromaFormat;
@@ -187,6 +191,12 @@ public:
   bool calCopyRun                 (CodingStructure &cs, Partitioner& partitioner, uint32_t startPos, uint32_t total, uint32_t &run, ComponentID compBegin);
   bool calIndexRun                (CodingStructure &cs, Partitioner& partitioner, uint32_t startPos, uint32_t total, uint32_t &run, ComponentID compBegin);
 #endif
+
+  // NN Intra Chroma Prediction
+#if NN_CHROMA_PRED
+  void initNNIntraChroma(const PredictionUnit &pu, const CompArea& area);
+  void predIntraNN(PelBuf &piPredCb, PelBuf &piPredCr, const PredictionUnit &pu, ComponentID compID, const ClpRng& clpRng);
+#endif
 };
 
 //! \}
diff --git a/source/Lib/CommonLib/NNIntraChromaPrediction.cpp b/source/Lib/CommonLib/NNIntraChromaPrediction.cpp
new file mode 100644
index 0000000..a00e5a9
--- /dev/null
+++ b/source/Lib/CommonLib/NNIntraChromaPrediction.cpp
@@ -0,0 +1,426 @@
+/*
+* Copyright 2021 BBC Research & Development
+*
+* Licensed under the Apache License, Version 2.0 (the "License");
+* you may not use this file except in compliance with the License.
+* You may obtain a copy of the License at
+*
+*     http://www.apache.org/licenses/LICENSE-2.0
+*
+* Unless required by applicable law or agreed to in writing, software
+* distributed under the License is distributed on an "AS IS" BASIS,
+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+* See the License for the specific language governing permissions and
+* limitations under the License.
+*
+* ==============================================================================
+*/
+
+/** \file     NNIntraChromaPrediction.cpp
+\brief    NN-based intra chroma prediction class
+*/
+
+#include "NNIntraChromaPrediction.h"
+#include "dtrace_next.h"
+
+#include "UnitTools.h"
+
+NNIntraChromaPrediction::NNIntraChromaPrediction() :
+
+  m_refSamplesY(NN_MAX_BOUNDARY_SIZE),
+  m_refSamplesCb(NN_MAX_BOUNDARY_SIZE),
+  m_refSamplesCr(NN_MAX_BOUNDARY_SIZE),
+  m_collocatedSamplesY(NN_MAX_OUTPUT_SAMPLES),
+
+  m_boundary1Pred(NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE),
+  m_padCollocatedSamplesY(NN_MAX_OUTPUT_SAMPLES),
+  m_inputPatchesY(NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE),
+  m_padAttPred(NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE),
+
+  m_attbPred(NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE),
+  m_attxPred(NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE),
+  m_attx1Pred(NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE),
+  m_attSoftmax(NN_MAX_OUTPUT_SAMPLES),
+  m_preAttMap(NN_MAX_BOUNDARY_SIZE * NN_MAX_OUTPUT_SAMPLES),
+  m_attMap(NN_MAX_BOUNDARY_SIZE * NN_MAX_OUTPUT_SAMPLES),
+
+  m_bound1Size(0, 0),
+  m_bound2Size(0, 0),
+  m_lumaSize(0, 0),
+  m_attbSize(0, 0),
+  m_attxSize(0, 0),
+  m_attx1Size(0, 0),
+  m_attMapSize(0, 0)
+{
+}
+
+void NNIntraChromaPrediction::prepareInputForPred(Pel* pSrcCb, Pel* pSrcCr, PelBuf pColY, const Area& block, uint32_t* stride, const int* availableRefs, const int bitDepth)
+{
+  initPredBlockParams(block);
+
+  CHECK(bitDepth != 10, "Only 10 bit internal bit depth available");
+  Pel valueDC = 1 << (bitDepth - 1);
+  int availableUnits;
+
+  uint32_t dstStride = 2 * block.height;
+  uint32_t chromaStride = stride[COMPONENT_Cb];
+  uint32_t lumaStride = 2 * MAX_CU_SIZE + 1;
+
+  Pel *srcCb, *srcCr, *srcY, *refY;
+
+  refY = pColY.bufAt(0, 0);
+  srcCb = pSrcCb + 1;
+  srcCr = pSrcCr + 1;
+
+  m_refSamplesCb.resize((2 * block.width) + (2 * block.height) + 1);
+  m_refSamplesCr.resize((2 * block.width) + (2 * block.height) + 1);
+  m_refSamplesY.resize((2 * block.width) + (2 * block.height) + 1);
+  m_collocatedSamplesY.resize(block.width * block.height);
+
+  srcY = refY - lumaStride;
+  availableUnits = availableRefs[0];
+  for (int x = 0; x < availableUnits; x++)
+  {
+    m_refSamplesCb[dstStride + 1 + x] = srcCb[x];
+    m_refSamplesCr[dstStride + 1 + x] = srcCr[x];
+    m_refSamplesY[dstStride + 1 + x] = srcY[x];
+  }
+  for (int x = availableUnits; x < 2 * block.width; x++)
+  {
+    m_refSamplesCb[dstStride + 1 + x] = valueDC;
+    m_refSamplesCr[dstStride + 1 + x] = valueDC;
+    m_refSamplesY[dstStride + 1 + x] = valueDC;
+  }
+  srcY = refY - 1;
+  availableUnits = availableRefs[1];
+  for (int y = 0; y < availableUnits; y++)
+  {
+    m_refSamplesCb[dstStride - 1 - y] = srcCb[chromaStride + y];
+    m_refSamplesCr[dstStride - 1 - y] = srcCr[chromaStride + y];
+    m_refSamplesY[dstStride - 1 - y] = srcY[lumaStride * y];
+  }
+  for (int y = availableUnits; y < 2 * block.height; y++)
+  {
+    m_refSamplesCb[dstStride - 1 - y] = valueDC;
+    m_refSamplesCr[dstStride - 1 - y] = valueDC;
+    m_refSamplesY[dstStride - 1 - y] = valueDC;
+  }
+  if (availableRefs[0] > 0 && availableRefs[1] > 0)
+  {
+    m_refSamplesCb[dstStride] = pSrcCb[0];
+    m_refSamplesCr[dstStride] = pSrcCr[0];
+    m_refSamplesY[dstStride] = srcY[0];
+  }
+  else
+  {
+    m_refSamplesCb[dstStride] = valueDC;
+    m_refSamplesCr[dstStride] = valueDC;
+    m_refSamplesY[dstStride] = valueDC;
+  }
+  for (int x = 0; x < block.width; x++)
+  {
+    for (int y = 0; y < block.height; y++) { m_collocatedSamplesY[y * block.width + x] = (long)refY[y * lumaStride + x]; }
+  }
+}
+
+void NNIntraChromaPrediction::matrixPred(long* input, long* output, const long*& matrix, const long*& bias, Size inputSize, Size outputSize, int shift)
+{
+  long value;
+  for (int y = 0; y < outputSize.height; y++)
+  {
+    for (int x = 0; x < outputSize.width; x++)
+    {
+      value = bias[x];
+      for (int j = 0; j < inputSize.width; j++) { value += (input[y * inputSize.width + j] * matrix[x * inputSize.width + j]); }
+      output[y * outputSize.width + x] = (RELU(value) + (1 << (shift - 1))) >> shift;
+    }
+  }
+}
+
+void NNIntraChromaPrediction::padInput(long* const input, long* const output, Size inputSize, int units, int channels)
+{
+  // TODO: Support 3D padding with channels parameter
+
+  int pad_units = units << 1;
+  int block_stride = inputSize.width * inputSize.height;
+  int inPos, outPos;
+
+  for (int y = 0; y < inputSize.height + pad_units; y++)
+  {
+    for (int x = 0; x < inputSize.width + pad_units; x++)
+    {
+      outPos = y * (inputSize.width + pad_units) + x;
+      for (int c = 0; c < channels; c++)
+      {
+        output[outPos * channels + c] = 0;
+      }
+    }
+  }
+  for (int j = 0; j < inputSize.height; j++)
+  {
+    for (int i = 0; i < inputSize.width; i++)
+    {
+      for (int c = 0; c < channels; c++)
+      {
+        inPos = j * inputSize.width + i;
+        outPos = (j + units) * (inputSize.width + pad_units) + (i + units);
+        output[outPos * channels + c] = input[inPos * channels + c];
+      }
+    }
+  }
+}
+
+void NNIntraChromaPrediction::getAttMap(long* const attbPred, long* const attxPred)
+{
+  m_preAttMap.resize(m_attMapSize.width * m_attMapSize.height);
+  m_attMap.resize(m_attMapSize.width * m_attMapSize.height);
+  m_attSoftmax.resize(m_attMapSize.width);
+
+  long* const preAtt = m_preAttMap.data();
+  long* const attMap = m_attMap.data();
+  long* const attSoftmax = m_attSoftmax.data();
+  long baseStride = m_attxSize.width;
+  long outStride = m_attMapSize.width;
+
+  const long *expTable, *sumTable;
+  expTable = &exp_table[0];
+  sumTable = &sum_table[0];
+
+  long value;
+  for (int y = 0; y < m_attMapSize.height; y++)
+  {
+    for (int x = 0; x < m_attMapSize.width; x++)
+    {
+      value = 0;
+      for (int i = 0; i < baseStride; i++) { value += attxPred[y * baseStride + i] * attbPred[x * baseStride + i]; }
+      preAtt[y * outStride + x] = (value + (1 << (SHIFT_PREATT - 1))) >> SHIFT_PREATT;
+    }
+  }
+  long long softValue, sumFactor = 0;
+  long expValue, sumValue, colsMax;
+  for (int y = 0; y < m_attMapSize.height; y++)
+  {
+    for (int x = 0; x < m_attMapSize.width; x++) { attSoftmax[x] = preAtt[y * m_attMapSize.width + x] << 1; }
+    colsMax = *std::max_element(std::begin(m_attSoftmax), std::end(m_attSoftmax));
+    for (int x = 0; x < m_attMapSize.width; x++) { attSoftmax[x] = std::max((long)-10, attSoftmax[x] - colsMax); }
+    sumValue = 0;
+    for (int x = 0; x < m_attMapSize.width; x++)
+    {
+      expValue = expTable[(EXP_TABLE_SIZE - 2) - (abs(attSoftmax[x]) << (EXP_BIT_TABLE - EXP_BIT_STEP))];
+      attSoftmax[x] = expValue;
+      sumValue += expValue;
+    }
+    sumFactor = (long long)sumTable[(sumValue >> SUM_BIT_STEP) - (1 << (SUM_BIT_PRECISION - SUM_BIT_STEP))];
+    for (int x = 0; x < m_attMapSize.width; x++)
+    {
+      softValue = attSoftmax[x] * sumFactor;
+      attMap[y * m_attMapSize.width + x] = (long)((softValue) >> SHIFT_SOFTMAX);
+    }
+  }
+}
+
+void NNIntraChromaPrediction::applyBoundaryBranch(long* boundaryPred)
+{
+  Pel* const refY = m_refSamplesY.data();
+  Pel* const refCb = m_refSamplesCb.data();
+  Pel* const refCr = m_refSamplesCr.data();
+
+  m_boundary1Pred.resize(m_bound1Size.width * m_bound1Size.height);
+  long* const output = m_boundary1Pred.data();
+
+  const long *matrix, *bias;
+  matrix = &w_boundary1[0][0];
+  bias = &b_boundary1[0];
+
+  long value;
+  for (int y = 0; y < m_bound1Size.height; y++)
+  {
+    for (int x = 0; x < m_bound1Size.width; x++)
+    {
+      value = bias[x];
+      value += (refY[y] * matrix[x * 3 + 0]);
+      value += (refCb[y] * matrix[x * 3 + 1]);
+      value += (refCr[y] * matrix[x * 3 + 2]);
+      output[y * m_bound1Size.width + x] = (RELU(value) + (1 << (SHIFT_BOUND1 - 1))) >> SHIFT_BOUND1;
+    }
+  }
+
+  matrix = &w_boundary2[0][0];
+  bias = &b_boundary2[0];
+
+  matrixPred(output, boundaryPred, matrix, bias, m_bound1Size, m_bound2Size, SHIFT_BOUND2);
+}
+
+void NNIntraChromaPrediction::applyLumaBranch(long* lumaPred)
+{
+  m_padCollocatedSamplesY.resize((m_blockSize.width + 4) * (m_blockSize.height + 4));
+  long* refY = m_collocatedSamplesY.data();
+  long* const refYpad = m_padCollocatedSamplesY.data();
+
+  padInput(refY, refYpad, m_blockSize, 2, 1);
+
+  const long* matrix, *bias;
+  matrix = &w_luma[0][0];
+  bias = &b_luma[0];
+
+  int fRows = 5;
+  int fCols = 5;
+  int numPatches = fRows * fCols;
+  int matrixStride = numPatches + 1;
+  int idx, pos, pos_aux, patchPos, px, py;
+  long value;
+
+  for (int y = 0; y < m_blockSize.height; y++)
+  {
+    for (int x = 0; x < m_blockSize.width; x++)
+    {
+      pos = (y * m_blockSize.width) + x;
+      pos_aux = pos + (4 * (pos / m_blockSize.height));
+
+      for (int c = 0; c < m_lumaSize.width; c++)
+      {
+        value = bias[c];
+        for (int rows = 0; rows < fRows; rows++)
+        {
+          for (int cols = 0; cols < fCols; cols++)
+          {
+            idx = (cols + ((m_blockSize.height + 4) * rows)) + pos_aux;
+            px = idx / (m_blockSize.width + 4);
+            py = idx % (m_blockSize.width + 4);
+            patchPos = fCols * rows + cols;
+            value += refYpad[(m_blockSize.width + 4) * px + py] * matrix[c * matrixStride + patchPos];
+          }
+        }
+        value += matrix[c * matrixStride + (matrixStride - 1)] * 1023;
+        lumaPred[pos * m_lumaSize.width + c] = (RELU(value) + (1 << (SHIFT_LUMA - 1))) >> SHIFT_LUMA;
+      }
+    }
+  }
+}
+
+void NNIntraChromaPrediction::applyAttentionBranch(long* attPred, long* boundaryPred, long* lumaPred)
+{
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_BOUNDARY_SIZE> attbTransposed(m_bound2Size.width * m_bound2Size.height);
+
+  const long *matrix, *bias;
+
+  m_attbPred.resize(m_attbSize.width * m_attbSize.height);
+  long* const attbPred = m_attbPred.data();
+  matrix = &w_att_b[0][0];
+  bias = &b_att_b[0];
+  matrixPred(boundaryPred, attbPred, matrix, bias, m_bound1Size, m_attbSize, SHIFT_ATTB);
+
+  m_attxPred.resize(m_attxSize.width * m_attxSize.height);
+  long* const attxPred = m_attxPred.data();
+  matrix = &w_att_x[0][0];
+  bias = &b_att_x[0];
+  matrixPred(lumaPred, attxPred, matrix, bias, m_lumaSize, m_attxSize, SHIFT_ATTX);
+
+  m_attx1Pred.resize(m_attx1Size.width * m_attx1Size.height);
+  long* const attx1Pred = m_attx1Pred.data();
+  matrix = &w_att_x1[0][0];
+  bias = &b_att_x1[0];
+  matrixPred(lumaPred, attx1Pred, matrix, bias, m_lumaSize, m_attx1Size, SHIFT_ATTX1);
+
+  getAttMap(attbPred, attxPred);
+
+  long* const attMap = m_attMap.data();
+  long* const attbT = attbTransposed.data();
+  for (int y = 0; y < m_bound2Size.width; y++)
+  {
+    for (int x = 0; x < m_bound2Size.height; x++) { attbT[y * m_bound2Size.height + x] = boundaryPred[x * m_bound2Size.width + y]; }
+  }
+
+  int pos;
+  long long value;
+  for (int y = 0; y < m_attMapSize.height; y++)
+  {
+    for (int x = 0; x < m_bound2Size.width; x++)
+    {
+      value = 0;
+      pos = y * m_bound2Size.width + x;
+      for (int i = 0; i < m_attMapSize.width; i++) {
+        value += attMap[y * m_attMapSize.width + i] * attbT[x * m_bound2Size.height + i];
+      }
+      attPred[pos] = (long)((value >> SHIFT_ATT) * attx1Pred[pos]) >> SHIFT_MASK;
+    }
+  }
+}
+
+void NNIntraChromaPrediction::applyTrunkBranch(Pel* cbPred, Pel* crPred, long* attPred)
+{
+  m_padAttPred.resize((m_blockSize.width + 2) * (m_blockSize.height + 2) * m_bound2Size.width);
+  long* const attPad = m_padAttPred.data();
+
+  int padUnits = 1;
+  int padChannels = m_bound2Size.width;
+  padInput(attPred, attPad, m_blockSize, padUnits, padChannels);
+
+  const long *matrix, *bias;
+  matrix = &w_out[0][0];
+  bias = &b_out[0];
+
+  int fRows = 3;
+  int fCols = 3;
+  int numPatches = fRows * fCols;
+  int matrixStride = (numPatches * padChannels) + 1;
+  int idx, pos, pos_aux, patchPos, chPos, p;
+  long value_cb, value_cr;
+
+  for (int y = 0; y < m_blockSize.height; y++)
+  {
+    for (int x = 0; x < m_blockSize.width; x++)
+    {
+      value_cb = bias[0];
+      value_cr = bias[1];
+      pos = (y * m_blockSize.width) + x;
+      pos_aux = pos + (2 * (pos / m_blockSize.height));
+      for (int ch = 0; ch < padChannels; ch++)
+      {
+        for (int rows = 0; rows < fRows; rows++)
+        {
+          for (int cols = 0; cols < fCols; cols++)
+          {
+            p = (fCols * rows) + cols;
+            idx = (cols + ((m_blockSize.height + 2) * rows)) + pos_aux;
+            chPos = idx * padChannels + ch;
+            patchPos = numPatches * ch + p;
+            value_cb += attPad[chPos] * matrix[patchPos];
+            value_cr += attPad[chPos] * matrix[patchPos + matrixStride];
+          }
+        }
+      }
+      value_cb += (matrix[matrixStride - 1]) << SHIFT_OUT;
+      value_cr += (matrix[(matrixStride << 1) - 1]) << SHIFT_OUT;
+      cbPred[pos] = (Pel)(value_cb >> SHIFT_OUT1);
+      crPred[pos] = (Pel)(value_cr >> SHIFT_OUT1);
+    }
+  }
+}
+
+void NNIntraChromaPrediction::predBlock(Pel* predCb, Pel* predCr)
+{
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE> boundaryPred(m_bound2Size.height * m_bound2Size.width);
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE> lumaPred(m_lumaSize.height * m_lumaSize.width);
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE> attPred(m_attMapSize.height * m_bound2Size.width);
+
+  applyBoundaryBranch(boundaryPred.data());
+  applyLumaBranch(lumaPred.data());
+  applyAttentionBranch(attPred.data(), boundaryPred.data(), lumaPred.data());
+  applyTrunkBranch(predCb, predCr, attPred.data());
+}
+
+void NNIntraChromaPrediction::initPredBlockParams(const Size& block)
+{
+  m_blockSize = block;
+  int boundarySize = (2 * block.width) + (2 * block.height) + 1;
+  int blockSize = block.width * block.height;
+
+  m_bound1Size = Size(32, boundarySize);
+  m_bound2Size = Size(32, boundarySize);
+  m_lumaSize = Size(64, blockSize);
+  m_attbSize = Size(16, boundarySize);
+  m_attxSize = Size(16, blockSize);
+  m_attx1Size = Size(32, blockSize);
+  m_attMapSize = Size(boundarySize, blockSize);
+}
diff --git a/source/Lib/CommonLib/NNIntraChromaPrediction.h b/source/Lib/CommonLib/NNIntraChromaPrediction.h
new file mode 100644
index 0000000..9b3c434
--- /dev/null
+++ b/source/Lib/CommonLib/NNIntraChromaPrediction.h
@@ -0,0 +1,352 @@
+/*
+* Copyright 2021 BBC Research & Development
+*
+* Licensed under the Apache License, Version 2.0 (the "License");
+* you may not use this file except in compliance with the License.
+* You may obtain a copy of the License at
+*
+*     http://www.apache.org/licenses/LICENSE-2.0
+*
+* Unless required by applicable law or agreed to in writing, software
+* distributed under the License is distributed on an "AS IS" BASIS,
+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+* See the License for the specific language governing permissions and
+* limitations under the License.
+*
+* ==============================================================================
+*/
+
+/** \file     NNIntraChromaPrediction.h
+\brief    NN-based intra chroma prediction class (header)
+*/
+
+#ifndef __NNINTRACHROMAPREDICTION__
+#define __NNINTRACHROMAPREDICTION__
+
+#include "Unit.h"
+
+static const int NN_MAX_BOUNDARY_SIZE = 65;
+static const int NN_MAX_OUTPUT_SAMPLES = 400;
+static const int NN_MAX_CHANNEL_SIZE = 96;
+
+static const int EXP_TABLE_SIZE = 1282;
+static const int EXP_BIT_TABLE = 8;
+static const int EXP_BIT_STEP = 1;
+static const int EXP_BIT_PRECISION = 15;
+static const int SUM_BIT_STEP = 8;
+static const int SUM_BIT_PRECISION = 15;
+
+static const int SHIFT_BOUND1 = 6;
+static const int SHIFT_BOUND2 = 10;
+static const int SHIFT_LUMA = 9;
+static const int SHIFT_ATTB = 10;
+static const int SHIFT_ATTX = 14;
+static const int SHIFT_ATTX1 = 11;
+static const int SHIFT_PREATT = 22;
+static const int SHIFT_SOFTMAX = 14;
+static const int SHIFT_ATT = 14;
+static const int SHIFT_MASK = 14;
+static const int SHIFT_OUT = 16;
+static const int SHIFT_OUT1 = 21;
+
+
+class NNIntraChromaPrediction
+{
+public:
+  NNIntraChromaPrediction();
+
+  void prepareInputForPred(Pel* pSrcCb, Pel* pSrcCr, PelBuf pColY, const Area& block, uint32_t* stride, const int* availableRefs, const int bitDepth);
+  void matrixPred(long* input, long* output, const long*& matrix, const long*& bias, Size inputSize, Size outputSize, int shift);
+  void padInput(long* const input, long* const output, Size inputSize, int units, int channels);
+  void getAttMap(long* const attbPred, long* const attxPred);
+  void applyBoundaryBranch(long* boundaryPred);
+  void applyLumaBranch(long* lumaPred);
+  void applyAttentionBranch(long* attPred, long* boundaryPred, long* lumaPred);
+  void applyTrunkBranch(Pel* cbPred, Pel* crPred, long* attPred);
+  void predBlock(Pel* predCb, Pel* predCr);
+
+  long w_luma[64][26] =
+  {
+    {-136, 12, 182, -129, -21, -218, -280, -2214, 172, -21, 495, -1313, 1645, -1775, 67, -125, -246, -2076, 10, 107, -40, 110, 192, 78, -157, 1664,},
+    {159, -88, -336, 325, 38, -90, -222, -542, 413, 78, -612, -864, -2870, 1083, -334, 285, 848, 1731, 2603, 77, -8, -115, -156, 283, 15, -336,},
+    {-7, -35, 4, -24, -19, 28, -71, -142, -94, -22, 115, -152, -249, -328, 34, -20, -99, 14, -36, -15, -15, 123, 58, 20, -42, 1144,},
+    {-1, -66, -191, -33, -2, 6, 102, 19, 4, -59, -99, -36, -530, -93, -190, -10, 130, 153, 62, -2, 38, 28, -142, 67, 5, 1023,},
+    {17, -3, -40, 21, 14, -2, -4, -87, 102, -35, -41, 122, -132, 53, -1, -42, -50, 30, 53, -11, -45, -64, 41, 9, 39, -231,},
+    {-25, -58, -127, -68, -108, 40, 100, 355, -25, -95, -126, 379, 936, 120, -172, -23, 169, 391, 78, -167, -56, -74, -101, -155, -2, 1479,},
+    {-4, -56, -189, 43, 14, -116, 10, 451, 3, -67, -296, 285, -974, 262, -277, 9, -59, 173, 27, 73, 28, -81, -161, -13, 102, 899,},
+    {-25, 38, 99, 20, -31, 103, -18, -170, -120, 69, -108, -83, 1043, 25, -96, 42, -101, -277, -176, 29, -45, 35, -39, -37, 41, 942,},
+    {30, -21, -100, 75, 46, -32, -234, -326, -83, 0, 19, -503, 456, 9, 98, 38, 3, -30, 309, 124, -16, 50, -5, 203, -24, 848,},
+    {-101, 57, 279, 7, 90, -151, 120, 18, 74, 13, 10, 549, -4141, 296, 142, -182, 50, 18, -74, -70, 7, 40, 39, -78, 68, 3175,},
+    {55, -120, -72, -48, 4, 0, 35, -151, 99, 17, -94, -173, 489, -81, -36, -7, 264, 91, 302, 8, -37, 2, -75, 86, 7, 951,},
+    {-6, 101, 86, -42, 60, 45, 285, 461, 178, -1, 60, 356, -154, 202, 69, -115, 143, 118, 55, -44, 3, -22, -167, -64, 15, 591,},
+    {55, 66, -37, 117, 78, 34, -117, -8, 13, -3, -122, -347, 806, 107, 12, -116, -57, -159, 122, 75, 27, -43, -130, 52, 9, 1935,},
+    {-107, -15, -21, 134, -112, 108, 0, -33, -95, 31, -96, -1025, 4779, -611, 128, 75, -80, -400, 46, 83, -45, 128, -30, 114, -113, -1630,},
+    {-22, -70, -17, -43, -36, -43, -59, -8, 83, 22, -120, 273, 1043, 110, -26, 49, -46, 70, 101, -36, 50, -36, -62, 1, -27, -72,},
+    {40, 62, -131, -26, 37, 43, 64, 137, 181, 10, -183, -559, 394, -290, -115, 81, 21, -78, 22, 98, 49, -49, -106, 60, 43, 1340,},
+    {3, -10, -55, 74, -41, -75, 95, -411, 204, 52, -141, -240, -1952, -93, -108, 82, 271, -305, -100, 49, 24, -75, -86, 97, -9, 1207,},
+    {-59, -16, 76, -189, 2, -40, 16, 115, 99, -101, 109, 741, -5010, 509, 60, -137, 160, 405, -141, -135, 21, -97, 159, -269, 37, 2840,},
+    {-2, 147, 111, 130, -70, 98, -242, -246, -208, -3, 195, -82, 2654, -21, 108, 20, -53, -159, -89, -32, -46, 39, 111, 3, -64, -28,},
+    {-62, -10, -346, 59, -71, -62, -224, -3564, -413, -24, 27, 616, 3691, 478, 54, -182, -456, 849, -142, -80, -21, 125, -144, -32, 101, -7,},
+    {-135, -127, -267, -105, -46, 53, -314, 468, -314, 98, -207, -610, 3756, -101, -67, -67, -353, 123, -200, 15, -48, 114, -85, 51, 8, -340,},
+    {-99, -222, -282, -236, -7, -76, -465, -471, -313, -111, 187, 224, 2560, -36, 165, -22, -277, 131, -464, -137, -35, 129, 134, -19, 39, 238,},
+    {80, 19, 338, 14, 70, 9, -190, -174, -72, -28, 393, -435, -3001, -609, 264, -32, -240, -515, -512, 20, 3, 88, 482, 18, 52, 4208,},
+    {-6, -11, -47, 26, -26, 56, -156, -149, 21, 96, 8, -31, -24, -21, -71, -10, 7, -140, -17, 78, -23, -37, -17, 41, -7, -122,},
+    {-61, -48, 52, -49, 10, 56, 25, -157, -21, -2, 180, 250, 914, 96, 113, 42, 40, -31, 42, 11, -8, -36, 22, -28, -69, 231,},
+    {-44, 79, 3, 16, 26, 82, -3, 298, 109, -29, -179, -118, 108, -7, -110, 73, 66, 70, 47, 66, 9, -32, -123, -66, -13, 1638,},
+    {28, -6, 153, -136, -21, -67, -321, -150, -439, 44, 47, -217, -5, -183, 18, -55, -164, 103, -102, -33, -76, -38, 24, -65, -13, 1007,},
+    {-2, -43, 154, 94, 123, -73, -348, -184, -373, 50, -140, -289, 4062, -71, 20, -73, -374, -57, -23, -35, -63, -62, -193, 85, 9, 2584,},
+    {-6, -49, -269, -129, -50, 135, -300, -191, -286, -42, -45, -142, 2965, 335, -113, 10, -208, 405, 271, 68, -39, 33, -6, 146, 40, 802,},
+    {-52, -93, -71, -14, -39, 13, -108, 390, -74, -42, -109, 234, 2622, 280, -70, 13, -32, 169, -29, -40, -63, -27, -75, 35, 0, -656,},
+    {-14, 11, -188, -31, 69, 27, -123, 431, -172, 18, -110, 425, 2369, 397, -138, 26, -111, 287, -45, -17, -19, 13, -179, 37, -4, -881,},
+    {-21, 16, -47, 8, 18, -138, -427, -60, -136, 1, 72, 6, 166, -104, -75, 44, -229, -122, -165, 21, 28, 43, -111, 24, 41, 852,},
+    {-22, 110, -132, 56, 66, 5, 49, -38, 90, -13, 43, 50, -1465, 16, -37, -141, -96, -241, -59, 21, 103, 5, -148, 58, 2, 1496,},
+    {-95, 76, -299, -25, 68, 88, -105, -347, -37, 114, 10, -106, 292, 639, -174, 32, 9, -289, -222, 68, -45, 65, -153, -74, 76, -211,},
+    {-190, -388, -14, -141, 54, -385, -606, -1205, -631, -266, 134, -721, 441, -758, 24, -149, -930, -1053, -1221, -120, 106, -46, 214, -196, 165, 990,},
+    {-6, -94, 101, -146, -120, -93, 51, -121, -51, 10, 212, -66, -234, -72, -17, 38, -116, -295, -256, -17, -74, 17, 68, -96, 17, 1626,},
+    {48, -176, 328, -112, 25, -14, -46, -303, 109, -105, 121, 388, -10528, 285, 70, -143, 218, 48, -124, -57, -29, -118, 327, -156, 5, 3013,},
+    {-49, -97, 176, -173, 101, -212, -674, -1416, -1094, -253, 556, 361, 1677, 545, 359, -179, -762, -833, -1104, -157, -58, -23, 139, -65, 28, 1503,},
+    {-87, -14, -183, 66, -24, 111, -142, 317, -167, 75, -153, -224, 5212, -56, -160, 67, -93, -23, 67, 42, -72, 24, -69, 138, -27, -1135,},
+    {-5, -108, 203, -142, 62, -53, -2, 399, -134, -117, 144, 123, -3588, 453, 109, -118, -53, 282, -37, -80, 16, -133, 197, -116, 79, 2100,},
+    {-163, -225, 627, -149, -88, -96, -654, -640, -1010, -388, 485, -380, 2627, -156, 462, -29, -982, -437, -562, -213, -270, -199, 789, -120, -271, 121,},
+    {23, 188, -211, 150, -14, -29, -39, -722, 286, 93, -165, -563, -2564, -264, -275, 60, 352, -539, 32, 89, 138, 13, -333, 114, 47, 1852,},
+    {-51, 313, 84, 593, -55, -209, -403, -2465, -590, -372, 547, -268, 2464, -7, 426, -53, -890, -3039, -1014, 47, 64, 361, 720, 343, -173, -1,},
+    {13, 20, 37, 161, 9, -38, -183, -287, -113, 39, -27, -520, 1073, -204, 28, 22, 0, -139, -159, 42, 0, 6, 5, 33, -16, 803,},
+    {-11, -18, -324, 118, -71, -44, -662, -217, -223, 5, -431, -233, 5447, 297, -215, 140, -126, 150, 51, 71, -78, -11, -211, 212, -50, 249,},
+    {13, 37, 7, 29, -41, 6, 24, 6, -124, -28, 130, 101, 1032, -182, 46, -13, -144, -219, -312, -64, 42, 92, -126, -102, -23, 445,},
+    {-427, -1088, -352, 237, 330, -803, -2225, 31, 95, -145, -1221, -3999, 724, 1566, 695, -327, -1945, -261, -315, -252, -191, -1033, -267, 69, 219, 360,},
+    {-210, -460, -713, -1076, -163, -158, -291, 67, -669, -132, 307, 666, 1283, 202, 190, -98, -10, 166, -389, -135, -92, -171, 183, -53, -38, 148,},
+    {-29, -44, 30, -82, -17, -66, -72, -80, -137, 73, -106, -325, 499, -275, 130, -34, -179, -221, -18, -28, -22, -6, 43, 22, 31, 1593,},
+    {-117, 13, -155, 161, -28, 191, -256, 212, -123, 97, -123, -282, 4617, -86, -165, 185, -36, -207, 29, 72, -68, 55, -160, 200, -73, -815,},
+    {50, -3, 175, -178, 62, 121, 379, 459, 179, -17, 268, 112, -1798, -108, -83, 88, 102, -166, -81, -32, 78, 58, 44, -78, 52, 1980,},
+    {89, -68, 48, 21, 12, 61, -382, -188, -96, 82, -384, -903, 2621, -125, -37, 108, 88, 78, 450, 205, -35, 0, -6, 173, 2, 409,},
+    {133, 134, -59, 25, 39, 213, 239, 385, 115, 53, -106, -30, -626, -359, -166, 44, 256, -65, 55, 26, 50, 30, -386, 121, 4, 1389,},
+    {80, 40, -173, -6, 30, 202, -71, 388, -288, 46, -16, 545, 811, 371, -228, -83, -272, 137, -255, -16, 95, 150, 16, -6, 22, -115,},
+    {22, -46, 65, 16, 37, -83, 14, 113, -18, -31, -212, 145, 1621, 446, -157, 9, -66, 531, 109, -31, -101, -18, -197, -24, 15, -24,},
+    {-106, -218, -273, -70, -44, -299, -330, -99, 70, -13, -179, 334, 697, 258, 33, 39, -29, 147, 105, 150, 7, 40, 25, 117, 70, 308,},
+    {-424, -415, -826, 62, -324, 211, -68, -1158, -75, 39, 487, 537, 1848, 229, 505, 219, 175, -1491, -11, -65, -503, -399, -508, -1, -280, -13,},
+    {-48, 30, 182, -43, -6, 96, -185, -155, 68, 119, -11, -213, 764, -116, 179, 18, -42, -234, -28, -41, 6, 12, 9, 79, -14, 242,},
+    {54, 113, 77, 55, -9, 19, -15, -88, -130, -21, 139, 13, 1277, -166, 65, -76, -11, -181, -303, -118, -13, -33, -45, -93, -25, 847,},
+    {8, -16, 80, 68, -26, -97, -335, -513, -290, -57, -49, -695, 4123, -66, 276, 10, -278, 130, 21, 103, -125, 73, 382, 185, 1, 708,},
+    {-39, 8, -40, 78, 3, 36, 77, 168, -22, 14, 60, 79, 1842, -173, -79, -75, -108, -25, 8, -55, -90, 44, -172, -42, -10, 1036,},
+    {34, -132, 199, -200, 49, -127, -137, 222, -39, -69, 186, -272, -3468, -1, 55, -243, -271, -98, 163, -51, 32, -135, 194, -67, -29, 2598,},
+    {7, -61, -90, -118, 49, -5, 224, 217, 13, 46, -231, 361, -1648, 97, -23, -118, -134, 430, -40, -24, 61, -10, -132, -48, 78, 1243,},
+    {18, -79, 13, -112, -25, 73, -263, -138, -213, -33, 38, -259, 1199, 142, -36, 53, -154, 108, 240, -6, -89, 61, 69, 4, -22, 1302,},
+  };
+
+  long b_luma[64] =
+  { 28255, 19561, 58500, 47403, -375, 79458, 58552, 65477, 56283, 124997, 15785, -3115, 79081, -42745, 625, 71120, 51617, 75213, 41849, 11676, -24735, 33586, 136551, -1507, 28014, 66290, 54813, 117722, 22521, -27465, -29432, 57425, 62339, -5969, 12714, 61122, 73608, 59178, -2547, 52346, 5312, 25719, -10686, 53417, 18366, 44203, -1466, 23026, 83771, -11574, 92353, 41005, 60571, 24179, -12397, 31542, -9760, 52313, 60538, 46759, 71109, 55569, 64205, 67136, };
+
+  long w_boundary1[32][3] =
+  {
+    {-523, -592, -42,},
+    {-284, 480, 452,},
+    {881, -853, -469,},
+    {-504, -501, 280,},
+    {381, 338, 451,},
+    {136, -402, 397,},
+    {515, 361, -503,},
+    {770, -24, 865,},
+    {-681, -133, 18,},
+    {-235, -349, -658,},
+    {874, -355, 622,},
+    {-110, -49, -275,},
+    {402, -56, 153,},
+    {510, 580, 481,},
+    {820, -293, 471,},
+    {174, 294, -423,},
+    {-1001, -108, 702,},
+    {-607, 440, 435,},
+    {899, 375, -384,},
+    {360, 815, -328,},
+    {-149, -248, 474,},
+    {-829, -638, 242,},
+    {-535, -297, -515,},
+    {783, -417, 775,},
+    {-714, -213, 436,},
+    {415, 320, -221,},
+    {222, 491, 230,},
+    {742, 729, -513,},
+    {-161, 365, 737,},
+    {504, 677, -312,},
+    {709, 621, 34,},
+    {887, -94, -293,},
+  };
+
+  long b_boundary1[32] =
+  { 0, -31057, -106988, 0, -94224, 207582, -161542, -29172, 0, 0, -70704, 0, -333093, 125688, -260339, 97421, 538536, 257840, 15434, 28948, 133701, 0, 0, 29181, 46903, -719, 53259, 48003, -4838, -101957, -335183, 48479, };
+
+  long w_boundary2[32][32] =
+  {
+    {286, 310, 564, 523, -372, 187, -730, -64, -164, -322, 444, 113, 828, 540, 608, -559, 74, -121, -357, -403, 303, 147, -302, -891, -680, 35, 227, 293, 566, 75, 192, -421,},
+    {-189, -511, -102, 381, 463, 455, -95, -396, -117, -445, -581, 7, -1093, -316, -7, 441, 303, -106, 669, 362, -134, 121, 219, 491, 332, 720, 318, -12, -214, 34, 16, -446,},
+    {-194, -82, -490, -446, -189, 343, -476, 243, -474, -288, 256, -37, -488, -20, 404, 68, -351, 131, 24, 581, -509, 298, -245, -206, -528, 48, 252, -337, 720, 348, 551, -590,},
+    {394, -519, -613, -307, -245, 607, 622, -415, -295, 65, 264, -297, -260, -424, -544, -181, 291, -532, -604, 559, -157, 539, -300, -115, -480, 202, 289, 428, 115, -444, -25, 81,},
+    {-6, 30, 28, -591, -601, -679, -413, 330, 353, 23, -186, -380, -316, 209, 300, 173, 716, 402, -336, 489, 264, 97, -57, -826, 322, -608, -101, 57, -246, -39, -719, -267,},
+    {-351, 452, -350, 211, 295, 590, -123, 285, -124, 582, -35, -124, 288, -324, -626, 603, -352, -349, 7, -89, 476, -275, -248, 58, 541, -414, -497, -249, 110, 458, -610, 184,},
+    {-539, 223, -18, -197, 616, 317, -608, 150, 185, -53, -440, 603, 246, -344, -477, 231, 488, -585, -223, -113, 342, -313, 291, 17, -274, 386, -569, -578, -296, 179, -394, -296,},
+    {483, -246, 474, -116, -364, -130, -76, -21, 286, -177, 101, 349, 575, 580, 315, 460, 291, 196, 571, -434, 633, 173, 154, -11, 328, 513, -132, -396, 509, 7, -483, -702,},
+    {43, 316, 199, 342, 191, -139, 722, -596, -439, 619, -383, 309, 86, -300, -168, -122, 197, 93, 332, 470, 555, -248, 523, 511, -101, 25, -51, 372, 75, -137, -288, 579,},
+    {-136, -273, -252, 269, 148, 436, 238, 501, -520, -505, -122, 389, -374, 596, -434, 109, -712, -505, -32, 525, 82, -586, 420, -53, -264, -362, 423, 527, -127, -76, 293, 214,},
+    {-446, 346, -568, 17, -527, 205, -161, -16, -407, 292, -271, 342, -577, 140, 234, -640, 455, -223, -144, -633, 215, 100, -565, -314, -595, -636, -12, -470, 221, 403, -172, -579,},
+    {-594, -562, 341, -539, -29, 160, -432, 509, 416, 314, -29, -77, -351, -564, -622, -219, 3, -433, 100, 439, 44, -33, -402, -591, -1, -268, -275, -574, -604, 532, 338, 541,},
+    {160, -568, 293, 318, 596, 406, 14, -192, -502, -210, -206, 226, -450, -229, -184, -165, 374, -203, -341, -463, 281, 149, 302, -556, 222, -382, -543, 184, 437, 376, 57, -460,},
+    {546, 295, 210, -243, 338, -373, 532, -46, -315, 48, -130, -192, -831, -427, -496, 411, 145, 168, 326, 591, 120, -483, 534, 197, -456, 295, -157, -219, 45, -131, 564, 472,},
+    {-30, -585, -871, 509, 704, -185, 208, 902, 198, 509, 1060, -146, -223, -146, 800, 418, -105, -307, 197, 113, -221, 592, 385, -100, -372, 166, 603, 719, -97, -140, -177, 734,},
+    {-115, 360, -21, -51, 253, -503, 17, 659, 239, -265, -23, 559, -68, -202, -210, -26, -70, 132, -506, 613, 32, 330, 17, 198, 297, -175, -463, -368, 86, 304, 359, 125,},
+    {-34, 146, 246, 618, -344, 448, 375, -113, -337, 212, 434, -161, 98, -261, -157, 413, -137, -513, -506, -538, -541, 565, -390, 119, -318, -138, -252, -597, -80, 615, 253, 307,},
+    {1, -438, -324, 245, 215, -504, -169, -119, 364, -339, -601, -376, -578, -92, 207, 249, -457, -435, 465, -223, -396, -328, -94, -407, 124, -40, -292, -330, -393, 351, -519, 220,},
+    {132, -259, -81, -277, -560, 223, -81, 760, -550, 284, 841, 166, 313, 510, 466, 329, -72, -1269, -230, 405, -42, 105, -460, 193, 199, -42, -50, 295, 14, 654, 453, 1744,},
+    {-489, 41, 536, 163, -470, -154, 189, -508, 393, -52, -128, -328, -432, -186, 428, 483, -554, -608, -282, 148, 378, -398, -239, 161, 0, -242, -3, -539, 181, 542, 379, 593,},
+    {-291, -481, -249, 583, -346, 383, -134, 423, -539, 208, 413, 85, -293, 263, 366, -192, -223, 109, 32, 540, 657, -593, -4, 690, 617, -537, 286, -323, -241, -499, -189, -95,},
+    {204, -434, 213, -419, 299, -206, -109, -615, 371, 514, -91, 367, -501, -466, -107, -435, 121, 621, -48, 500, -524, -351, 445, 33, 193, -286, -428, -92, -434, 338, 93, 595,},
+    {162, 23, 761, 426, -147, 377, 140, -200, -522, 188, -834, 146, -1078, 281, -869, 206, 780, 405, -661, 282, 3, 435, -430, 161, 397, -303, 363, -254, 155, 59, -715, 239,},
+    {103, 39, 245, 117, -64, -310, -80, 668, 238, -398, 700, -221, 703, -222, 606, -308, -804, -719, -438, 750, -443, 436, 3, 590, -519, -162, 448, 156, -478, 424, -114, 494,},
+    {126, 517, 465, -406, -159, -59, -855, 36, 324, -232, -321, -52, -60, -578, -227, -604, 806, 773, 27, 346, -536, 299, -292, -426, 429, -914, -18, 348, -393, -277, -424, 164,},
+    {-618, -625, -148, 152, -181, 466, 394, -4, -406, -596, -357, 587, 350, -421, 318, 390, 14, -225, -391, 31, 153, 262, -594, -326, 3, -291, 241, -79, 596, -123, 339, 8,},
+    {80, -13, 427, -513, 599, -76, 475, 345, -623, 70, -242, 122, -76, 85, -210, -33, 490, -389, -307, -533, 301, 282, 165, -624, -300, 275, 596, 381, 57, 366, -173, -105,},
+    {468, -139, 144, -36, -412, 136, -88, -14, 86, -232, -280, -183, -175, -115, 159, -143, -210, -382, 257, -78, -283, -257, -370, -362, 484, 2, 478, 139, -40, -315, -72, -130,},
+    {402, -345, -155, 144, -522, -61, -93, -364, -46, -115, -312, -392, -281, -161, 593, 34, 14, 514, -96, 278, 226, 409, 537, 417, -185, -477, -430, -345, 48, 446, -84, -537,},
+    {254, 537, 317, 467, 43, -416, 101, 124, -182, 352, -670, -518, 351, 589, 53, -328, 787, 688, -539, 345, 460, 92, 557, 6, 197, 538, 127, 502, -98, -33, -505, -853,},
+    {-547, -873, -438, 596, 678, -291, 445, 656, -8, -288, 531, -406, 321, -422, 289, 383, -511, -353, 580, 112, -28, 162, -441, 593, -1139, -157, -51, -256, -54, 376, 687, 482,},
+    {431, -201, 664, -392, -236, 306, 333, 650, 229, 145, -52, 545, -13, -182, -626, -229, 50, -250, 90, 195, 359, -369, 574, 417, 99, -225, -453, -270, 637, 26, -26, 298,},
+  };
+
+  long b_boundary2[32] =
+  { 1710624, 2196739, -5468392, 0, 16786672, 94899, 0, 517772, -3264, 2099658, -2977872, 0, 0, 308125, -9108883, -1380451, 0, 0, -17534560, -741011, 332071, 0, 17904396, -15996558, -197397, 0, -1758844, 0, 0, 8833988, -14177273, 2076604, };
+
+  long w_att_b[16][32] =
+  {
+    {99, -3, -212, -71, 240, 20, -49, 138, 147, -237, 94, -53, -134, -17, -67, -24, -23, -81, -378, 114, -49, -106, 168, -346, -90, -147, -100, -19, -64, 185, -299, -71,},
+    {197, 102, 61, -176, -177, 190, 80, 45, -162, 34, -42, -139, -171, -193, 5, 161, -178, -54, 84, -175, 50, -146, 58, 43, -122, 63, 70, -23, -23, -32, -273, -12,},
+    {8, -11, -21, -104, -95, -138, 178, 198, -58, -78, 99, -94, -149, -112, 121, 121, 165, 93, -207, 128, 82, -161, 24, 100, 73, 30, 17, 0, -94, -72, 52, 58,},
+    {76, 109, 296, 158, -557, 8, 22, -47, 15, 104, -48, 179, 179, 170, 70, -190, -107, -140, 283, -159, 93, -60, -138, -37, -925, -56, -199, -7, 109, -134, -28, 230,},
+    {-5, -88, -202, -18, -32, -165, 10, -87, 75, -46, 27, 47, -88, 44, -170, -55, 104, -112, 166, -132, 30, -132, -89, -207, 17, -92, 63, 122, -107, -86, 124, 138,},
+    {-151, -13, 263, 101, -972, 86, -34, -11, -116, 280, 5, 152, -39, 152, 173, -232, -113, -160, 324, -171, -47, 172, -841, 449, 108, -1, -406, -60, -14, -450, 479, 152,},
+    {-109, -44, -87, -20, 49, -67, -32, -79, -125, 149, -131, -134, -101, 54, 180, -60, 33, -2, 2, 85, -53, 65, -51, 113, 124, 109, -91, -144, 10, 84, 162, -126,},
+    {-100, -50, -8, -156, -183, 104, 109, 135, -73, 48, -87, -89, 143, 56, -275, 73, -140, -109, -248, -175, 61, 24, 54, -310, 111, -128, 14, -69, -119, 165, -264, -244,},
+    {180, 207, 130, -157, -272, 26, 23, -77, -132, 69, -13, 128, 46, -36, 6, 142, 115, -118, -186, 55, 24, -82, -66, -15, -675, 110, -167, -71, 70, -10, -224, 118,},
+    {-32, 180, 137, -158, -272, 114, -176, 140, 83, 85, 140, 78, -148, 81, -5, -12, 21, -58, -139, -155, 76, 33, -287, -226, -725, 43, -34, 77, -20, -253, 119, 54,},
+    {62, -70, -103, -22, 32, 102, -168, 216, -26, -51, -57, 116, 34, 121, -364, 69, 25, 52, -64, -1, -140, -88, -73, -300, -163, -172, 48, 10, -58, -30, -344, -105,},
+    {-23, 198, -46, 25, -275, 34, -2, -190, 151, 75, 145, -102, 13, 56, -125, -236, 3, -132, -61, -8, -90, 158, -25, -81, -63, -136, 174, -93, 160, 122, 111, 39,},
+    {11, -83, 72, 155, -234, 16, -127, 96, -76, 314, 62, 81, 34, 40, 170, 91, 125, -90, 4, -110, 114, -77, -337, -122, -989, 49, -123, 86, -73, 32, 57, -36,},
+    {2, 70, 229, -100, -391, 143, -108, -76, -111, 93, -75, -118, 153, 165, 121, -200, 61, -145, 192, -93, 155, 117, -212, -28, -988, -103, -53, 88, 37, -223, 147, 78,},
+    {-56, -134, -173, -97, 107, -58, 29, 214, 85, -101, -79, -168, 169, -31, -70, -20, -39, -173, -349, 177, 42, 19, 29, -211, -111, 65, 81, 130, 22, -123, -126, -204,},
+    {-131, 24, 131, 75, -269, -76, 47, -90, -48, 250, 63, 37, 113, -14, 257, -21, 26, 111, 154, 16, 149, -21, -199, -110, -815, -162, -267, 44, -1, -221, -115, 213,},
+  };
+
+  long b_att_b[16] =
+  { 70002264, 2123214, 1022360, 46396924, 3403173, 12141821, -475011, 61284740, 33185254, 47350368, 65460360, 5216162, 38950400, 48718940, 55879868, 48314480, };
+
+
+  long w_att_x[16][64] =
+  {
+    {456, 496, 313, 245, -154, 192, -3, 292, 197, 470, 10, -39, -35, -902, 172, 172, 343, 618, -149, -12, -408, -178, 226, -92, 2, 220, 127, 163, -272, 25, -129, 399, 467, 66, 1134, -13, 1390, 392, -550, 634, -404, 729, -814, -59, -43, -120, 822, 406, 390, 17, 407, -230, 214, 84, -250, 124, -1266, 255, -61, -124, 258, 877, -5, 304,},
+    {-110, -46, 380, 252, -173, 228, -123, -54, 340, 239, 407, 27, 313, -118, -116, 7, -574, -437, 101, -244, -189, 136, 61, -162, 73, 272, 232, 153, 71, 8, 94, 129, 262, 24, -438, 154, -1407, 411, 277, -158, 249, -116, 176, 147, 206, 31, 131, 367, 194, -18, -29, 281, 245, -169, 179, 367, -311, 104, 150, -78, 81, -598, 146, 351,},
+    {-286, -481, 253, 258, 187, 340, 281, -161, 177, -207, 303, -100, 223, -285, 244, 154, -2, 70, -125, -173, -391, -48, 167, -12, 86, 25, -61, 138, 260, 80, 204, 187, -9, -443, -458, 339, -1014, 98, -34, -78, 157, -355, -813, 163, -20, 94, 113, 158, -185, -55, 173, 127, 41, 127, 261, 325, -439, -35, -176, 383, -86, -151, -94, -132,},
+    {399, -996, 398, 115, 189, 53, 62, 467, 252, -339, 411, -46, 306, 573, 390, -13, 426, -404, 224, -65, 569, 232, -24, 170, 232, 150, -37, 747, 437, 520, 615, 32, -393, -34, -190, 53, -1024, 9, 798, -666, 1258, 309, 638, 347, 706, 69, -1219, -403, 255, 573, -167, 675, 352, 264, 612, 70, 1341, -13, 126, 478, 231, -562, -176, 324,},
+    {-328, 385, 289, 212, -276, 489, 57, 165, 569, 169, 467, 588, 471, 575, 183, 504, -616, 85, 673, 482, 660, 420, 384, 9, 590, 356, -243, 162, 698, 450, 599, 250, -95, -122, -275, 481, -362, 271, 641, -28, 404, -453, 102, 534, 262, 373, 873, 84, 448, 257, 416, 389, 103, 522, 692, 582, 444, 270, 325, 687, 454, -438, 328, 257,},
+    {-139, -91, -22, -297, 181, -212, -463, -148, -101, -437, 300, 10, -113, 863, 295, -212, 1056, -786, 245, 298, 439, 117, -120, -67, 291, -30, -438, 184, -17, 208, 415, -201, -630, -80, 25, -136, -200, -680, 511, -518, 353, 828, -410, 97, 399, -38, -520, -415, -372, 321, -170, -39, 43, -51, 372, -132, 712, 106, 235, -163, 156, -847, -426, -232,},
+    {-154, 154, 39, 56, -193, -56, -185, -282, -277, -303, 101, -264, 38, 171, -152, -183, 47, 38, 204, -191, -38, -171, 193, -27, 99, -51, 111, 165, -155, -216, -91, -229, -224, -256, -179, -132, -182, 254, 198, 232, 137, 250, -12, -31, -84, 38, -257, 115, 243, 176, -198, -56, 167, -267, 4, -201, 250, -80, -213, -18, 184, -55, 233, -52,},
+    {1183, 711, 568, 732, -228, 514, 797, 450, 347, 887, 196, 511, 416, -756, 256, 539, 829, 1187, 118, 310, -166, 476, 647, 158, 217, 364, 986, 238, -110, -82, -68, 546, 1034, 205, -477, 434, 2571, 667, -364, 1161, -601, 1122, -377, 491, -208, 474, 918, 815, 346, -335, 627, 43, 147, 401, -10, 238, -863, 352, 270, -9, 597, 1589, 514, 472,},
+    {-251, -298, 283, 159, 108, -25, 291, 300, 455, 259, 8, 274, 289, -280, 365, 509, -175, -248, 158, -363, 4, 50, 64, -101, 163, 305, 58, 522, 336, 411, -105, 112, 309, 343, -859, 469, -2707, 368, -21, -462, 334, -379, 142, 460, 53, -61, 8, 344, 200, 417, 351, 393, 278, 305, 530, 356, -172, 333, 431, 251, 307, -189, -11, 307,},
+    {234, -557, 92, 100, -103, 361, -221, 162, 411, -95, 303, 439, 169, 978, 495, 388, -376, -622, 435, -277, 822, 211, 65, 140, 355, 289, 115, 668, 628, 392, 283, -121, -8, 263, -151, 390, -1289, -73, 342, -670, 338, -289, 384, 68, 200, 316, -234, -420, 248, 306, 106, 160, 244, 133, 358, -65, 1130, 207, 340, 660, 377, -290, -201, 353,},
+    {1035, 756, 459, 466, 247, 444, 614, 541, 34, 910, -9, 237, 616, -339, -11, 591, 1607, 1396, -12, 59, -350, 62, 655, 117, 418, 449, 689, 227, -172, -253, 319, 598, 621, 143, -234, 463, 3048, 581, -33, 1419, -208, 1181, 88, 212, -281, 141, 734, 537, 598, -18, 425, 240, 77, 58, -208, 323, -1044, 351, 412, 73, 134, 1576, 651, 230,},
+    {202, 467, 229, 338, 99, 385, 77, 144, 237, 79, 362, 70, -158, 13, -62, 38, -436, 322, 22, 39, -89, 132, -145, -266, 375, -34, 126, -55, 306, 331, 361, 28, 10, -161, -592, 233, -515, -70, 256, -196, 315, -425, -357, -43, 186, 120, 408, 276, 100, 102, 407, -101, 49, 142, -142, -1, -357, 149, 240, -2, 262, -92, -20, 332,},
+    {174, -960, -28, -244, 151, -117, 71, 281, 28, -30, -47, 185, 134, 98, 458, 156, 254, -365, 515, -490, 113, 69, 104, 182, 393, 219, 9, 631, 378, 237, -17, -108, 205, -94, -179, 246, -1427, -31, 552, -128, 777, 15, -3, 35, 448, -113, -1086, -266, 328, 136, 116, 369, -58, -192, 164, 343, 657, 380, -107, 395, 206, -245, 96, 251,},
+    {384, -897, 202, -411, -149, 304, -66, 357, 103, -185, 539, 393, 230, 770, 322, 212, 482, -649, 389, -488, 382, -49, -140, 162, 184, 196, 111, 147, 162, 77, 465, 111, -176, -31, -207, 391, -489, 86, 528, -721, 868, 419, 491, 415, 659, -31, -834, -324, -147, 715, -119, 369, -161, 97, 326, 67, 1155, 340, 367, 470, -42, -122, -24, 267,},
+    {1000, 196, 53, 295, -19, 352, 515, 305, 169, 583, 13, 394, 181, -762, -67, 403, 765, 372, 114, -23, -152, -190, 101, 23, -152, -121, 618, 170, 154, -324, -309, 57, 680, -51, 1193, 413, 2286, 403, -518, 544, -280, 1059, -518, 377, -309, 227, 580, 638, 84, 11, 463, -262, 390, -61, -63, -44, -1293, -91, 280, -276, 299, 931, 217, -88,},
+    {371, -1308, -150, 73, 34, 402, 27, 187, 463, -74, 179, 310, 277, 758, 65, 51, -4, -337, 380, -568, 700, 241, -20, 162, 2, 501, 85, 573, 491, 345, 550, -121, -81, -95, 788, 210, -1467, -284, 696, -666, 1115, -18, 248, 323, 399, -63, -864, -80, 174, 772, 351, 429, 191, 178, 173, 68, 1376, -76, 133, 484, 481, -596, -39, 114,},
+  };
+
+  long b_att_x[16] =
+  { 391261, 195180, 106629, 194119, 675442, -333456, -26503, 1073654, 437424, 83406, 966431, 244964, 211628, 22426, 545351, 167748, };
+
+
+  long w_att_x1[32][64] =
+  {
+    {717, 210, -443, 1000, -635, 774, 825, -177, 877, -61, 487, -967, -142, -263, -676, 779, 588, 866, 51, 653, 639, -829, 404, 443, 564, -586, -504, -869, -897, 446, 750, 346, -749, 638, 903, -589, 446, 453, 464, 821, -425, 108, 2, 172, -382, 915, 212, -394, 448, 282, 756, 460, -480, -775, -811, -399, -28, 745, -176, -180, 945, 417, 173, -527,},
+    {603, -245, -767, -387, -959, 949, 355, -744, -806, 766, 34, 900, 737, -577, 948, -180, -487, -1083, 332, -1210, -1388, 707, 443, 690, -96, -855, 155, 423, 115, -930, -410, 83, -472, 909, -145, 9, -627, 819, -1149, -825, 1229, -343, -2099, 4, 246, 691, 1156, 1070, -47, -879, 734, -202, -368, -136, 637, 1033, -539, 22, -709, 620, 374, 32, -596, 1057,},
+    {651, 47, 608, 30, 266, 907, 683, 246, -576, 158, -371, 958, 71, -71, 450, -180, -400, -985, -249, -296, -670, 122, -36, -706, 443, -130, -487, 819, -718, -11, 953, 575, -143, 450, 1178, 899, -33, 214, 564, 399, 465, -897, -1320, 2, 179, 138, 452, 383, -232, -904, -119, 556, 577, 263, -775, 707, 35, -655, -222, 608, -845, -561, -554, -496,},
+    {993, 8, -130, 418, 18, -102, -778, -823, 802, 827, 667, 47, -659, 379, -270, 324, 617, 81, 960, 492, 727, -981, -892, -575, -233, -495, 418, 1011, 594, -824, -632, -979, -119, 726, 722, -991, -664, 1021, 281, -838, 462, 824, 938, 895, 281, 642, 937, 794, 310, -371, 537, -41, 971, 888, -694, 128, 384, -157, -286, 848, 730, -511, 600, 159,},
+    {-345, -339, -355, 174, 52, 691, -632, -943, 1020, 169, -555, -958, -986, 476, -847, -95, -459, -68, -109, -576, -614, -376, 760, 278, -101, 646, -406, -711, 562, 905, -143, 484, -324, -285, -748, -723, -996, -747, -132, 207, 262, -766, 577, -129, -375, 370, -362, 608, 92, 351, -876, -827, -268, -313, 233, -890, 569, 7, -613, -988, -32, -479, -734, -459,},
+    {75, 322, 1014, 846, 433, -698, 251, 793, -184, -738, -520, 667, 926, 1001, -707, 881, 656, 942, 230, 506, -310, 510, 670, -630, -719, -515, 251, -414, -697, -159, -866, 133, 959, -719, 1062, 262, 959, 21, -680, 467, 601, -422, -691, -291, -344, -1, -291, -557, -857, -202, -447, 344, 662, 121, -664, -150, -686, -441, 261, 172, -799, -362, -300, 304,},
+    {779, 622, 194, 471, -36, 866, 311, 69, 10, 571, 968, -159, -292, 997, 695, -432, 436, -48, -121, -410, -103, 743, 57, 676, -291, -946, -368, 252, 173, 275, 399, 941, -862, 149, -442, 1023, 321, 654, 956, -76, 418, 160, 954, -528, -624, 157, 191, 305, 588, -983, -831, -635, -416, -253, -159, 961, 633, -266, 69, 991, -340, -505, -887, 246,},
+    {-517, 101, -87, 454, -819, -239, 879, 660, 39, 447, -223, -361, 413, -340, 930, 953, 444, 39, 4, -301, -541, 222, -330, -639, -825, 134, 510, -224, 73, -825, -15, 860, -172, 52, -115, -685, 157, -157, -340, -101, 408, -873, -176, 753, 528, 809, 222, 318, 710, 132, -51, -720, 190, 503, -176, 899, 318, 221, 453, -568, 864, -1191, -302, 901,},
+    {-10, -185, 820, -447, -17, 89, 545, -749, 33, -54, -821, -755, 997, 373, -803, -608, 1001, 853, 165, 793, 1854, -639, 396, 183, -183, -642, 990, -79, -55, 1091, -800, -973, 834, -777, -735, -235, 967, -235, -306, -916, -617, -147, 1322, -35, -95, 164, -933, -485, -173, 701, 946, 450, 545, -552, 517, -312, 56, 461, -736, -818, -902, 756, -511, 534,},
+    {-653, -502, 552, 672, -530, 337, 182, 686, 710, 600, -961, -734, 43, 349, 154, 819, 243, 269, 806, -33, -500, -207, -1012, -1017, -273, -719, 182, -74, -451, -208, -883, -40, 925, -201, -1117, 366, 406, -264, -243, -263, -304, -167, 756, 611, -199, -1151, -409, 62, 2, 715, 652, 691, -806, 203, 202, 324, 388, 767, 454, -666, 567, 98, 663, 845,},
+    {-287, 728, 195, -598, -158, -13, -647, -688, -48, -1016, 758, -909, 196, 325, 15, 181, -86, -453, -505, 674, -826, -217, 967, -994, -934, -543, 769, 284, 887, 680, 883, 261, -191, -105, 756, -742, 924, -51, -13, -279, -80, -597, 1016, -625, -164, -1065, -488, -354, -575, 53, -3, -776, 719, -347, 362, 324, -792, 154, -34, 863, -644, 710, -909, 256,},
+    {-374, -619, -412, 927, -839, -216, -264, -51, 215, -694, 671, -268, 171, 136, -712, 314, 457, 421, -200, 946, -922, 395, 704, -593, -68, 373, 98, 383, -667, 508, 896, 1014, 252, 512, 462, -56, 482, 219, -428, 383, 394, 548, -669, 561, 63, 624, 971, -825, 380, 35, 719, -445, -239, -411, 978, 287, 611, 36, 692, 187, -600, 311, 713, 952,},
+    {742, -951, 61, -887, 638, -424, -132, -909, 188, -451, -613, -693, 157, -254, -490, -628, -242, -770, 423, -292, -823, -662, -999, 687, 498, -978, 937, -685, 140, 253, 728, 669, 993, 169, 623, 640, -886, -403, -246, 129, 992, 120, 929, 974, -787, 944, -646, -884, 301, 783, 908, 481, -689, 59, 204, 248, 527, -291, 962, -968, 99, 134, -983, 237,},
+    {1267, 1054, 366, 887, 882, -236, 511, 959, -650, -862, -744, 916, -789, -1072, -729, 399, 897, -37, -218, -538, -561, 1033, 971, -203, 986, -556, -258, -593, -192, -502, -528, 27, 134, 1147, 2579, -474, -721, 1025, -209, -743, -46, -840, -1504, 46, 687, 813, 958, 371, 1032, -358, -451, 908, -309, 51, 110, -219, -622, 519, 1081, 525, 316, 289, 910, -398,},
+    {-53, -154, -719, 975, -398, -835, 197, -762, 347, -235, -80, 141, -368, 67, 445, -77, 818, 948, 730, 138, 368, -417, 221, -530, 171, -321, 590, 663, 282, -1098, -231, -1071, -151, 1530, -304, 542, -987, -480, 642, -205, -102, -365, 251, -450, -788, 590, -65, -131, 555, 491, -969, -470, 297, 815, 887, 745, -9, -167, 904, -275, -783, 647, -849, 189,},
+    {1297, 77, 567, -683, -881, 36, -845, 635, 469, -167, 800, -630, 575, -894, -210, 473, -629, -457, 48, -597, -945, 383, 865, -891, 766, -681, 566, 65, -17, -353, -125, -71, -584, -861, 652, 168, -975, 1096, -27, -623, 867, 654, -1788, 607, -326, 950, 1104, 542, 1020, -1023, 567, -246, -429, -1091, -878, -472, -1065, 405, 275, 1123, 912, 737, -829, 532,},
+    {-320, 159, -617, -62, -613, 302, 604, 90, 225, 513, 942, 354, -868, 267, -594, 953, 841, 761, 165, -544, 696, 12, 246, -75, 698, 864, -634, -489, -198, 446, -969, 956, 467, 464, -377, 383, -587, -163, -162, -381, -99, 682, -811, 39, 516, 306, -339, -836, -832, -269, 431, -837, -141, 557, -806, 29, 323, 619, 809, -653, 116, 542, 736, -405,},
+    {1007, 253, -1021, -451, 810, 845, -118, -932, -374, 974, -307, -280, 493, -49, 122, 1005, 854, 551, -504, -343, -212, -459, -134, -325, -851, -601, 135, 118, 311, 1004, 30, -773, -516, -687, 73, 211, 738, -295, -192, -492, -1001, -438, 441, -409, 860, 980, -565, 788, -488, 287, -377, 563, 111, 696, 354, -743, 119, 741, -578, 531, 85, 438, 907, 336,},
+    {-110, 123, 768, -416, -23, -763, 26, -856, -530, -415, -599, -327, 616, -1063, 647, 321, 667, 730, -342, 55, -102, -126, 142, -675, -558, -219, -418, -137, 737, 755, -11, -301, -636, 916, 1487, 359, 1951, 358, -11, -194, -104, 1067, -307, 1106, -606, 611, -58, 166, 277, 564, 291, 694, 181, -406, 94, -403, -133, -329, -850, -81, 776, 52, 273, -469,},
+    {-379, 831, -537, -694, -5, -797, 194, 482, -779, 444, 860, -608, -748, -745, -291, -934, 839, -275, 754, -318, -917, -225, -504, -24, -606, 138, 316, 778, 50, -495, -265, 157, 850, -682, 747, -906, 636, -92, -791, -735, 780, 20, 672, 727, -801, -271, -184, 415, 537, -962, -328, -316, -185, 351, -931, 824, 498, 529, 119, -494, -786, 207, 830, -52,},
+    {891, 1045, -988, 544, -560, 922, -622, 843, -43, -939, -182, -932, 187, -926, -774, 425, 107, -616, 993, -359, -119, 730, 299, 226, -910, 791, -649, 448, -888, 472, 675, 563, -116, 1048, 2752, -394, -30, 781, -592, -455, 213, -83, -1240, -837, -974, 549, 760, 229, 201, -1004, 10, 220, 590, 204, -600, 1013, -381, 43, 65, 910, 269, -217, 654, -774,},
+    {-984, -350, 139, -778, 926, -391, -524, -922, -364, 513, -897, 132, -395, -59, 423, 957, 13, -35, -99, 892, -154, 1013, -261, -847, 852, -698, -227, 173, 82, 942, -544, 381, -255, 557, -861, 821, 49, -76, -990, -578, -32, 97, 582, 283, 1023, 315, -147, 604, 119, -662, 452, 185, -790, 141, -180, -928, 537, 282, -943, 674, -772, -759, 243, 273,},
+    {-87, 448, 889, 937, 595, -568, 181, -747, -342, 700, -994, 158, -353, 200, 973, -502, -371, -812, -972, -836, 262, 726, -142, 759, -572, -170, -486, -801, 2, -816, 898, 145, -603, 719, 839, 13, 830, 155, -873, 969, 417, 323, 858, 63, 518, -986, -418, -198, -925, 3, 128, -871, -213, -383, 776, -979, -798, -424, -511, 70, -314, -345, -835, -590,},
+    {110, -929, -417, -96, -160, -729, 195, 332, 672, -146, 687, 319, -78, -968, -284, 925, 497, 969, -865, 713, 85, -723, 136, -464, -895, -323, 408, -49, -815, -622, 836, -940, 892, -722, -57, -551, 408, -313, -407, -937, -441, -777, -1022, -858, 564, -28, 703, -857, -825, -240, -775, 537, -248, -542, 485, 298, 605, -294, -711, 179, -784, -369, -940, 198,},
+    {-319, -25, 47, -217, 437, -696, -210, 464, -432, 531, -208, 68, -882, -1585, 1924, 1057, 730, 898, -967, 408, 1448, 70, 123, 652, 107, 471, 224, 15, 124, -888, -995, -99, 623, 1586, -393, 610, 127, -464, 76, -750, -641, -39, 1288, -542, -185, 418, -325, -136, -754, 826, -731, 791, 46, 369, 722, -485, 662, -404, -315, 30, -33, 299, -677, 13,},
+    {551, -237, 478, 713, -665, 606, 164, -50, -566, -908, -390, -852, 41, 63, 108, -312, 831, -499, 739, -879, 203, 471, -46, -471, 72, -62, -120, -30, -809, 716, 45, 965, -627, 674, 468, -1005, 774, -799, -947, 423, 555, -824, 217, -20, 309, -220, 752, 755, -127, 716, 420, 514, -553, -946, -318, -117, 852, -703, -616, -661, -468, -359, 244, 14,},
+    {-681, -339, -438, 397, 602, 312, 454, 930, -202, 806, -638, -798, 654, -231, -12, -415, 557, -594, 781, -499, -565, 523, -348, -836, 621, 1063, 703, 692, 1069, 24, -387, 1053, -274, 703, -1008, -381, 140, -520, -780, -461, 225, -383, -744, -770, -125, 952, 103, 457, 498, 838, -33, -128, -168, 485, 543, 270, 452, 243, -431, -244, -374, -505, 59, -725,},
+    {-773, 481, 512, -423, 901, -918, -832, -346, 16, -361, 311, -482, -127, -410, -632, -238, -95, 711, 929, -319, -375, -464, 989, 342, 255, 691, -514, 180, -441, 713, 852, -146, 889, 581, 975, 838, -209, 478, -807, -2, 674, 61, -855, -540, 392, -957, -1016, 498, 635, -1001, -544, -908, -332, -232, 232, 74, -547, -82, -859, -974, -658, 4, -411, -492,},
+    {-141, 109, -242, 457, -773, 322, -320, 485, -44, -469, 1008, 675, -163, -467, -501, 258, 710, -680, -420, -428, -860, 976, -142, -240, 800, -765, -980, 1016, -502, -296, -159, -512, 805, 868, 145, 1008, -748, 921, -818, 12, 432, 778, -516, -43, 758, 85, -404, -381, -163, -252, 962, 335, -5, 896, 884, -43, 309, -571, -266, 204, 168, -699, 924, 1021,},
+    {-566, 335, -863, 933, -208, 339, -486, 939, -855, -262, -903, 875, 313, 468, -179, -758, -712, -247, -33, 630, -891, -455, -600, 1000, 852, -894, -915, -204, -253, -661, -586, 742, 884, 725, 168, 128, -854, -469, -148, 936, -474, -87, -677, -101, -418, 194, 533, -646, 971, 560, -269, -565, -779, -503, 139, -270, 135, -768, -357, -679, 376, 897, -617, 17,},
+    {905, -996, 565, 401, 981, -1003, -833, -12, -982, -280, 12, -327, 433, 386, 103, 753, 701, -838, 558, -315, -917, 503, -290, 793, 817, 725, -93, -215, -504, -89, 123, 804, 84, -197, 841, -855, -619, -442, 277, 893, 645, -1007, 438, -617, -857, -961, -333, 915, -915, -243, 450, 707, -685, -277, -2, -670, -17, 902, 408, -421, -937, 12, -853, -386,},
+    {890, -345, 404, -748, -683, 746, 714, 280, 659, 808, 325, -586, -699, -948, 821, -601, -894, -939, 382, -735, -1088, 28, 573, 112, 895, 310, 614, -524, 19, 128, -15, 877, 635, -877, 34, 983, -617, 811, -778, -661, 319, -194, -1686, 440, 327, 211, 939, 726, 728, 28, 467, 899, -732, -160, 220, -532, -276, 745, -152, 470, 682, -298, 635, -475,},
+  };
+
+  long b_att_x1[32] =
+  { -19801, 68385, 57413, 0, 0, 299117, 0, 381902, 351469, -108121, -13440, 0, 0, 314969, 74987, 458661, 0, 0, 96654, 8087, 293518, 0, 3106, 5542, 9574, 0, 221060, 0, 0, 1533, -29942, 365586, };
+
+
+  long w_out[2][289] =
+  {
+    {306, 330, 589, 341, 7321, 440, 501, 765, 455, 1171, -201, 757, -86, 576, -262, 330, -204, 193, 743, 2680, 911, 3446, 7105, 2654, 711, 3308, 661, 772, -1194, -192, -1236, -808, -982, 5671, -221, -3471, 71, 46, -2788, -638, 6821, -3905, -141, -1832, 2861, -1851, -1651, -3398, -6549, -7123, -6295, -2397, -4424, -5347, -463, 2865, 990, 3141, -1125, -157, -399, 2140, -579, -1587, -1096, -1210, -985, 6401, -787, -1285, -720, -938, -108, -498, -993, -545, 6072, -888, -819, -1846, -638, 645, 558, 202, 650, 4461, 596, 386, 380, 458, -1971, -1838, -1309, 1219, -1324, -3344, 1619, -6160, 1793, -503, -6, 1392, 152, -1165, -1095, 1023, -1703, 1350, -1810, 1404, 118, -991, -1481, 2659, -137, -2285, 1712, -1887, 1136, -1058, 1214, 11565, 1338, -396, 1443, -254, 586, 180, 96, 387, -754, 31, 137, 76, 67, 706, 3219, 471, 3640, 13369, 3136, 686, 3080, 189, -2521, 98, -2953, 2099, 385, -3663, 124, 1690, 400, -702, 2230, -1694, 4575, 2364, 1834, 218, 377, 1492, -222, 315, -140, 290, 214, 287, -38, 386, -110, -4187, 265, -1580, 993, 356, -1053, 787, -1033, -2094, 2102, -187, 823, -237, -5652, -560, 652, -818, 518, -1906, -130, -4909, 2254, -2945, -273, -401, 675, 977, -8, 1325, -1160, 3489, 945, -1408, -1346, 118, 942, 3389, -554, 2154, 683, -1627, 224, -1666, 2171, -333, 466, -371, 175, 75, -1968, 776, 293, 240, -163, -493, 1565, -1347, 73, -536, -2059, 100, 2680, -1332, 3848, 3919, 2485, 4171, 4197, 3632, 2457, 3494, 2487, 1975, 1302, 195, 574, -891, -2189, 2091, 4791, 1009, 151, 2879, -132, -3832, 2372, -913, -693, 585, 1827, 885, 3810, 1082, -758, 3218, 72, 3200, 1667, -722, -2562, -555, -1920, -4271, -2370, -2185, 4039, 799, 746, -1681, -3466, -995, -4198, -11105, -3571, -1225, -3568, -837, 9063,},
+    {-923, -3060, -1142, -2556, -109, -2495, -1050, -3149, -841, -3856, -5747, -2600, -5979, -10475, -4852, -2221, -5002, -1908, 3704, 2564, 2463, 3593, -924, 2749, 2627, 2312, 2220, -757, -2770, 1061, 774, 2113, 3978, 2531, 15, -1118, -685, 821, 1336, 412, -2166, 528, -1683, -4855, 2240, 4271, 3702, 8440, 4401, 6647, 7816, 5772, 5051, 6311, 1683, 1998, 23, 1156, 2230, -1772, 4329, -1145, 3720, 2828, 2443, 2257, 2167, 3053, 2124, 2317, 2081, 1940, 560, 1382, 1720, -534, 7467, 462, 848, 1752, 1252, -1329, -63, -655, -381, 5786, -134, -692, 108, -509, 1273, 1917, -2104, 1349, 2777, -3234, 1722, -1148, 505, -1312, -1076, 883, 926, -1022, -1668, -4587, -729, -1737, -918, 2565, -2439, -50, -1041, -3490, -2002, 4155, 2166, 3506, -347, 1866, -1492, -6303, -1740, 923, -1655, 886, -613, 144, -141, 205, 37, 272, 251, 524, 263, -505, 4493, -222, 5021, 19099, 4438, 250, 4876, -309, 1541, 678, -778, -94, 1121, -325, 123, 2099, 2619, -489, 304, 483, -642, -1885, -1011, -1715, 2817, 2267, 551, -208, 400, -28, -2476, -314, -18, -440, 110, 372, -2289, -907, -2262, -746, 432, 710, 1079, -188, -3125, -154, -1455, -12, 6431, 476, -927, 861, -683, -523, -211, 2186, 1502, -3119, 1514, -3801, 549, -911, 692, -2079, 1170, 1592, -3133, -2732, -409, 3168, 1140, -42, -1979, -2459, 3577, -419, 2520, -2718, 1409, -56, -2619, -1024, -2927, 318, 6587, -387, -2100, -295, -2526, -191, -4678, 190, 1422, -1253, -327, 680, -4273, 803, -1306, -1291, -731, -237, 3739, -339, -1119, -629, -678, -1024, -2163, 2971, 1375, 1254, -149, 399, 2811, -2033, 92, -110, -570, -2481, -559, 833, -2433, 753, -2480, -1495, 1088, 3842, -4126, -109, -1209, 166, -599, 352, 1833, -1553, -4086, 474, -819, -3608, -1894, 1039, -2235, 2195, 1183, 1089, 1562, 2687, 779, 932, 779, 920, 8654,},
+  };
+
+  long b_out[2] =
+  { 109698032, 134890382, };
+
+  long exp_table[1282] =
+  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 27, 27, 27, 27, 28, 28, 28, 28, 28, 29, 29, 29, 29, 30, 30, 30, 30, 31, 31, 31, 31, 32, 32, 32, 32, 33, 33, 33, 33, 34, 34, 34, 34, 35, 35, 35, 36, 36, 36, 36, 37, 37, 37, 38, 38, 38, 38, 39, 39, 39, 40, 40, 40, 41, 41, 41, 42, 42, 42, 43, 43, 43, 44, 44, 44, 45, 45, 45, 46, 46, 47, 47, 47, 48, 48, 48, 49, 49, 50, 50, 50, 51, 51, 52, 52, 52, 53, 53, 54, 54, 54, 55, 55, 56, 56, 57, 57, 58, 58, 58, 59, 59, 60, 60, 61, 61, 62, 62, 63, 63, 64, 64, 65, 65, 66, 66, 67, 67, 68, 68, 69, 70, 70, 71, 71, 72, 72, 73, 73, 74, 75, 75, 76, 76, 77, 78, 78, 79, 79, 80, 81, 81, 82, 83, 83, 84, 85, 85, 86, 87, 87, 88, 89, 89, 90, 91, 92, 92, 93, 94, 94, 95, 96, 97, 97, 98, 99, 100, 101, 101, 102, 103, 104, 105, 105, 106, 107, 108, 109, 110, 111, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 147, 148, 149, 150, 151, 152, 154, 155, 156, 157, 159, 160, 161, 162, 164, 165, 166, 167, 169, 170, 171, 173, 174, 176, 177, 178, 180, 181, 183, 184, 185, 187, 188, 190, 191, 193, 194, 196, 197, 199, 201, 202, 204, 205, 207, 209, 210, 212, 213, 215, 217, 219, 220, 222, 224, 226, 227, 229, 231, 233, 235, 236, 238, 240, 242, 244, 246, 248, 250, 252, 254, 256, 258, 260, 262, 264, 266, 268, 270, 272, 274, 276, 279, 281, 283, 285, 287, 290, 292, 294, 297, 299, 301, 304, 306, 308, 311, 313, 316, 318, 321, 323, 326, 328, 331, 334, 336, 339, 341, 344, 347, 350, 352, 355, 358, 361, 364, 366, 369, 372, 375, 378, 381, 384, 387, 390, 393, 396, 399, 402, 406, 409, 412, 415, 418, 422, 425, 428, 432, 435, 439, 442, 446, 449, 453, 456, 460, 463, 467, 471, 474, 478, 482, 486, 489, 493, 497, 501, 505, 509, 513, 517, 521, 525, 529, 533, 537, 542, 546, 550, 555, 559, 563, 568, 572, 577, 581, 586, 590, 595, 600, 604, 609, 614, 619, 624, 628, 633, 638, 643, 648, 654, 659, 664, 669, 674, 680, 685, 690, 696, 701, 707, 712, 718, 723, 729, 735, 741, 746, 752, 758, 764, 770, 776, 782, 788, 795, 801, 807, 813, 820, 826, 833, 839, 846, 853, 859, 866, 873, 880, 886, 893, 900, 908, 915, 922, 929, 936, 944, 951, 959, 966, 974, 981, 989, 997, 1005, 1012, 1020, 1028, 1036, 1045, 1053, 1061, 1069, 1078, 1086, 1095, 1103, 1112, 1121, 1130, 1138, 1147, 1156, 1165, 1175, 1184, 1193, 1202, 1212, 1221, 1231, 1241, 1250, 1260, 1270, 1280, 1290, 1300, 1310, 1321, 1331, 1341, 1352, 1363, 1373, 1384, 1395, 1406, 1417, 1428, 1439, 1451, 1462, 1473, 1485, 1497, 1508, 1520, 1532, 1544, 1556, 1568, 1581, 1593, 1606, 1618, 1631, 1644, 1657, 1670, 1683, 1696, 1709, 1723, 1736, 1750, 1763, 1777, 1791, 1805, 1819, 1834, 1848, 1863, 1877, 1892, 1907, 1922, 1937, 1952, 1967, 1983, 1998, 2014, 2030, 2046, 2062, 2078, 2094, 2111, 2127, 2144, 2161, 2178, 2195, 2212, 2229, 2247, 2265, 2282, 2300, 2318, 2336, 2355, 2373, 2392, 2411, 2429, 2449, 2468, 2487, 2507, 2526, 2546, 2566, 2586, 2607, 2627, 2648, 2668, 2689, 2710, 2732, 2753, 2775, 2796, 2818, 2840, 2863, 2885, 2908, 2931, 2954, 2977, 3000, 3024, 3047, 3071, 3095, 3120, 3144, 3169, 3194, 3219, 3244, 3269, 3295, 3321, 3347, 3373, 3400, 3426, 3453, 3480, 3508, 3535, 3563, 3591, 3619, 3647, 3676, 3705, 3734, 3763, 3793, 3822, 3852, 3883, 3913, 3944, 3975, 4006, 4037, 4069, 4101, 4133, 4165, 4198, 4231, 4264, 4298, 4331, 4365, 4400, 4434, 4469, 4504, 4539, 4575, 4611, 4647, 4683, 4720, 4757, 4795, 4832, 4870, 4908, 4947, 4986, 5025, 5064, 5104, 5144, 5184, 5225, 5266, 5307, 5349, 5391, 5433, 5476, 5519, 5562, 5605, 5649, 5694, 5738, 5783, 5829, 5874, 5921, 5967, 6014, 6061, 6109, 6156, 6205, 6253, 6302, 6352, 6402, 6452, 6503, 6554, 6605, 6657, 6709, 6762, 6815, 6868, 6922, 6976, 7031, 7086, 7142, 7198, 7254, 7311, 7368, 7426, 7484, 7543, 7602, 7662, 7722, 7783, 7844, 7905, 7967, 8030, 8093, 8156, 8220, 8285, 8350, 8415, 8481, 8548, 8615, 8682, 8750, 8819, 8888, 8958, 9028, 9099, 9170, 9242, 9315, 9388, 9461, 9536, 9610, 9686, 9762, 9838, 9915, 9993, 10072, 10151, 10230, 10310, 10391, 10473, 10555, 10638, 10721, 10805, 10890, 10975, 11061, 11148, 11236, 11324, 11413, 11502, 11592, 11683, 11775, 11867, 11960, 12054, 12149, 12244, 12340, 12437, 12534, 12633, 12732, 12832, 12932, 13034, 13136, 13239, 13343, 13447, 13553, 13659, 13766, 13874, 13983, 14093, 14203, 14315, 14427, 14540, 14654, 14769, 14885, 15002, 15119, 15238, 15358, 15478, 15599, 15722, 15845, 15969, 16095, 16221, 16348, 16476, 16606, 16736, 16867, 16999, 17133, 17267, 17402, 17539, 17677, 17815, 17955, 18096, 18238, 18381, 18525, 18670, 18817, 18964, 19113, 19263, 19414, 19566, 19720, 19874, 20030, 20187, 20346, 20505, 20666, 20828, 20991, 21156, 21322, 21489, 21658, 21828, 21999, 22171, 22345, 22521, 22697, 22875, 23055, 23235, 23418, 23601, 23787, 23973, 24161, 24351, 24542, 24734, 24928, 25124, 25321, 25519, 25719, 25921, 26124, 26329, 26536, 26744, 26954, 27165, 27378, 27593, 27809, 28027, 28247, 28469, 28692, 28917, 29144, 29373, 29603, 29835, 30069, 30305, 30543, 30782, 31024, 31267, 31512, 31759, 32008, 32259, 32512, 32768, 32768, };
+
+  long sum_table[8193] =
+  { 32768, 32513, 32263, 32017, 31775, 31536, 31300, 31068, 30840, 30615, 30393, 30174, 29959, 29746, 29537, 29330, 29127, 28926, 28728, 28532, 28339, 28149, 27962, 27776, 27594, 27413, 27235, 27060, 26886, 26715, 26546, 26379, 26214, 26051, 25890, 25731, 25575, 25420, 25266, 25115, 24966, 24818, 24672, 24528, 24385, 24244, 24105, 23967, 23831, 23696, 23563, 23431, 23301, 23172, 23045, 22919, 22795, 22671, 22550, 22429, 22310, 22192, 22075, 21959, 21845, 21732, 21620, 21509, 21399, 21290, 21183, 21076, 20971, 20867, 20763, 20661, 20560, 20460, 20360, 20262, 20164, 20068, 19972, 19878, 19784, 19691, 19599, 19508, 19418, 19328, 19239, 19152, 19065, 18978, 18893, 18808, 18724, 18641, 18558, 18477, 18396, 18315, 18236, 18157, 18078, 18001, 17924, 17848, 17772, 17697, 17623, 17549, 17476, 17403, 17331, 17260, 17189, 17119, 17050, 16980, 16912, 16844, 16777, 16710, 16644, 16578, 16513, 16448, 16384, 16320, 16256, 16194, 16131, 16070, 16008, 15947, 15887, 15827, 15768, 15709, 15650, 15592, 15534, 15477, 15420, 15363, 15307, 15252, 15196, 15141, 15087, 15033, 14979, 14926, 14873, 14820, 14768, 14716, 14665, 14614, 14563, 14513, 14463, 14413, 14364, 14315, 14266, 14217, 14169, 14122, 14074, 14027, 13981, 13934, 13888, 13842, 13797, 13751, 13706, 13662, 13617, 13573, 13530, 13486, 13443, 13400, 13357, 13315, 13273, 13231, 13189, 13148, 13107, 13066, 13025, 12985, 12945, 12905, 12865, 12826, 12787, 12748, 12710, 12671, 12633, 12595, 12557, 12520, 12483, 12446, 12409, 12372, 12336, 12300, 12264, 12228, 12192, 12157, 12122, 12087, 12052, 12018, 11983, 11949, 11915, 11881, 11848, 11814, 11781, 11748, 11715, 11683, 11650, 11618, 11586, 11554, 11522, 11491, 11459, 11428, 11397, 11366, 11335, 11305, 11275, 11244, 11214, 11184, 11155, 11125, 11096, 11066, 11037, 11008, 10979, 10951, 10922, 10894, 10866, 10837, 10810, 10782, 10754, 10727, 10699, 10672, 10645, 10618, 10591, 10564, 10538, 10512, 10485, 10459, 10433, 10407, 10381, 10356, 10330, 10305, 10280, 10255, 10230, 10205, 10180, 10155, 10131, 10106, 10082, 10058, 10034, 10010, 9986, 9962, 9939, 9915, 9892, 9868, 9845, 9822, 9799, 9776, 9754, 9731, 9709, 9686, 9664, 9642, 9619, 9597, 9576, 9554, 9532, 9510, 9489, 9467, 9446, 9425, 9404, 9383, 9362, 9341, 9320, 9300, 9279, 9258, 9238, 9218, 9198, 9177, 9157, 9137, 9118, 9098, 9078, 9058, 9039, 9020, 9000, 8981, 8962, 8943, 8924, 8905, 8886, 8867, 8848, 8830, 8811, 8793, 8774, 8756, 8738, 8719, 8701, 8683, 8665, 8648, 8630, 8612, 8594, 8577, 8559, 8542, 8525, 8507, 8490, 8473, 8456, 8439, 8422, 8405, 8388, 8371, 8355, 8338, 8322, 8305, 8289, 8272, 8256, 8240, 8224, 8208, 8192, 8176, 8160, 8144, 8128, 8112, 8097, 8081, 8065, 8050, 8035, 8019, 8004, 7989, 7973, 7958, 7943, 7928, 7913, 7898, 7884, 7869, 7854, 7839, 7825, 7810, 7796, 7781, 7767, 7752, 7738, 7724, 7710, 7695, 7681, 7667, 7653, 7639, 7626, 7612, 7598, 7584, 7570, 7557, 7543, 7530, 7516, 7503, 7489, 7476, 7463, 7449, 7436, 7423, 7410, 7397, 7384, 7371, 7358, 7345, 7332, 7319, 7307, 7294, 7281, 7269, 7256, 7244, 7231, 7219, 7206, 7194, 7182, 7169, 7157, 7145, 7133, 7121, 7108, 7096, 7084, 7073, 7061, 7049, 7037, 7025, 7013, 7002, 6990, 6978, 6967, 6955, 6944, 6932, 6921, 6909, 6898, 6887, 6875, 6864, 6853, 6842, 6831, 6820, 6808, 6797, 6786, 6775, 6765, 6754, 6743, 6732, 6721, 6710, 6700, 6689, 6678, 6668, 6657, 6647, 6636, 6626, 6615, 6605, 6594, 6584, 6574, 6563, 6553, 6543, 6533, 6523, 6512, 6502, 6492, 6482, 6472, 6462, 6452, 6442, 6432, 6423, 6413, 6403, 6393, 6384, 6374, 6364, 6355, 6345, 6335, 6326, 6316, 6307, 6297, 6288, 6278, 6269, 6260, 6250, 6241, 6232, 6223, 6213, 6204, 6195, 6186, 6177, 6168, 6159, 6150, 6141, 6132, 6123, 6114, 6105, 6096, 6087, 6078, 6069, 6061, 6052, 6043, 6034, 6026, 6017, 6009, 6000, 5991, 5983, 5974, 5966, 5957, 5949, 5940, 5932, 5924, 5915, 5907, 5899, 5890, 5882, 5874, 5866, 5857, 5849, 5841, 5833, 5825, 5817, 5809, 5801, 5793, 5785, 5777, 5769, 5761, 5753, 5745, 5737, 5729, 5722, 5714, 5706, 5698, 5691, 5683, 5675, 5667, 5660, 5652, 5645, 5637, 5629, 5622, 5614, 5607, 5599, 5592, 5584, 5577, 5570, 5562, 5555, 5548, 5540, 5533, 5526, 5518, 5511, 5504, 5497, 5489, 5482, 5475, 5468, 5461, 5454, 5447, 5440, 5433, 5426, 5418, 5412, 5405, 5398, 5391, 5384, 5377, 5370, 5363, 5356, 5349, 5343, 5336, 5329, 5322, 5315, 5309, 5302, 5295, 5289, 5282, 5275, 5269, 5262, 5256, 5249, 5242, 5236, 5229, 5223, 5216, 5210, 5203, 5197, 5190, 5184, 5178, 5171, 5165, 5159, 5152, 5146, 5140, 5133, 5127, 5121, 5115, 5108, 5102, 5096, 5090, 5084, 5077, 5071, 5065, 5059, 5053, 5047, 5041, 5035, 5029, 5023, 5017, 5011, 5005, 4999, 4993, 4987, 4981, 4975, 4969, 4963, 4957, 4951, 4946, 4940, 4934, 4928, 4922, 4917, 4911, 4905, 4899, 4894, 4888, 4882, 4877, 4871, 4865, 4860, 4854, 4848, 4843, 4837, 4832, 4826, 4821, 4815, 4809, 4804, 4798, 4793, 4788, 4782, 4777, 4771, 4766, 4760, 4755, 4750, 4744, 4739, 4733, 4728, 4723, 4718, 4712, 4707, 4702, 4696, 4691, 4686, 4681, 4675, 4670, 4665, 4660, 4655, 4650, 4644, 4639, 4634, 4629, 4624, 4619, 4614, 4609, 4604, 4599, 4593, 4588, 4583, 4578, 4573, 4568, 4563, 4559, 4554, 4549, 4544, 4539, 4534, 4529, 4524, 4519, 4514, 4510, 4505, 4500, 4495, 4490, 4485, 4481, 4476, 4471, 4466, 4462, 4457, 4452, 4447, 4443, 4438, 4433, 4429, 4424, 4419, 4415, 4410, 4405, 4401, 4396, 4391, 4387, 4382, 4378, 4373, 4369, 4364, 4359, 4355, 4350, 4346, 4341, 4337, 4332, 4328, 4324, 4319, 4315, 4310, 4306, 4301, 4297, 4293, 4288, 4284, 4279, 4275, 4271, 4266, 4262, 4258, 4253, 4249, 4245, 4240, 4236, 4232, 4228, 4223, 4219, 4215, 4211, 4206, 4202, 4198, 4194, 4190, 4185, 4181, 4177, 4173, 4169, 4165, 4161, 4156, 4152, 4148, 4144, 4140, 4136, 4132, 4128, 4124, 4120, 4116, 4112, 4108, 4104, 4100, 4096, 4092, 4088, 4084, 4080, 4076, 4072, 4068, 4064, 4060, 4056, 4052, 4048, 4044, 4040, 4036, 4032, 4029, 4025, 4021, 4017, 4013, 4009, 4006, 4002, 3998, 3994, 3990, 3986, 3983, 3979, 3975, 3971, 3968, 3964, 3960, 3956, 3953, 3949, 3945, 3942, 3938, 3934, 3930, 3927, 3923, 3919, 3916, 3912, 3908, 3905, 3901, 3898, 3894, 3890, 3887, 3883, 3880, 3876, 3872, 3869, 3865, 3862, 3858, 3855, 3851, 3847, 3844, 3840, 3837, 3833, 3830, 3826, 3823, 3819, 3816, 3813, 3809, 3806, 3802, 3799, 3795, 3792, 3788, 3785, 3782, 3778, 3775, 3771, 3768, 3765, 3761, 3758, 3754, 3751, 3748, 3744, 3741, 3738, 3734, 3731, 3728, 3724, 3721, 3718, 3715, 3711, 3708, 3705, 3701, 3698, 3695, 3692, 3688, 3685, 3682, 3679, 3675, 3672, 3669, 3666, 3663, 3659, 3656, 3653, 3650, 3647, 3644, 3640, 3637, 3634, 3631, 3628, 3625, 3622, 3618, 3615, 3612, 3609, 3606, 3603, 3600, 3597, 3594, 3591, 3587, 3584, 3581, 3578, 3575, 3572, 3569, 3566, 3563, 3560, 3557, 3554, 3551, 3548, 3545, 3542, 3539, 3536, 3533, 3530, 3527, 3524, 3521, 3518, 3515, 3512, 3509, 3506, 3504, 3501, 3498, 3495, 3492, 3489, 3486, 3483, 3480, 3477, 3474, 3472, 3469, 3466, 3463, 3460, 3457, 3454, 3452, 3449, 3446, 3443, 3440, 3437, 3435, 3432, 3429, 3426, 3423, 3421, 3418, 3415, 3412, 3410, 3407, 3404, 3401, 3398, 3396, 3393, 3390, 3387, 3385, 3382, 3379, 3377, 3374, 3371, 3368, 3366, 3363, 3360, 3358, 3355, 3352, 3350, 3347, 3344, 3342, 3339, 3336, 3334, 3331, 3328, 3326, 3323, 3320, 3318, 3315, 3313, 3310, 3307, 3305, 3302, 3300, 3297, 3294, 3292, 3289, 3287, 3284, 3281, 3279, 3276, 3274, 3271, 3269, 3266, 3264, 3261, 3258, 3256, 3253, 3251, 3248, 3246, 3243, 3241, 3238, 3236, 3233, 3231, 3228, 3226, 3223, 3221, 3218, 3216, 3214, 3211, 3209, 3206, 3204, 3201, 3199, 3196, 3194, 3192, 3189, 3187, 3184, 3182, 3179, 3177, 3175, 3172, 3170, 3167, 3165, 3163, 3160, 3158, 3155, 3153, 3151, 3148, 3146, 3144, 3141, 3139, 3137, 3134, 3132, 3130, 3127, 3125, 3123, 3120, 3118, 3116, 3113, 3111, 3109, 3106, 3104, 3102, 3100, 3097, 3095, 3093, 3090, 3088, 3086, 3084, 3081, 3079, 3077, 3075, 3072, 3070, 3068, 3066, 3063, 3061, 3059, 3057, 3054, 3052, 3050, 3048, 3045, 3043, 3041, 3039, 3037, 3034, 3032, 3030, 3028, 3026, 3024, 3021, 3019, 3017, 3015, 3013, 3010, 3008, 3006, 3004, 3002, 3000, 2998, 2995, 2993, 2991, 2989, 2987, 2985, 2983, 2981, 2978, 2976, 2974, 2972, 2970, 2968, 2966, 2964, 2962, 2959, 2957, 2955, 2953, 2951, 2949, 2947, 2945, 2943, 2941, 2939, 2937, 2935, 2933, 2931, 2928, 2926, 2924, 2922, 2920, 2918, 2916, 2914, 2912, 2910, 2908, 2906, 2904, 2902, 2900, 2898, 2896, 2894, 2892, 2890, 2888, 2886, 2884, 2882, 2880, 2878, 2876, 2874, 2872, 2870, 2868, 2866, 2864, 2863, 2861, 2859, 2857, 2855, 2853, 2851, 2849, 2847, 2845, 2843, 2841, 2839, 2837, 2835, 2833, 2832, 2830, 2828, 2826, 2824, 2822, 2820, 2818, 2816, 2814, 2813, 2811, 2809, 2807, 2805, 2803, 2801, 2799, 2798, 2796, 2794, 2792, 2790, 2788, 2786, 2785, 2783, 2781, 2779, 2777, 2775, 2774, 2772, 2770, 2768, 2766, 2764, 2763, 2761, 2759, 2757, 2755, 2753, 2752, 2750, 2748, 2746, 2744, 2743, 2741, 2739, 2737, 2736, 2734, 2732, 2730, 2728, 2727, 2725, 2723, 2721, 2720, 2718, 2716, 2714, 2713, 2711, 2709, 2707, 2706, 2704, 2702, 2700, 2699, 2697, 2695, 2693, 2692, 2690, 2688, 2686, 2685, 2683, 2681, 2680, 2678, 2676, 2674, 2673, 2671, 2669, 2668, 2666, 2664, 2663, 2661, 2659, 2657, 2656, 2654, 2652, 2651, 2649, 2647, 2646, 2644, 2642, 2641, 2639, 2637, 2636, 2634, 2632, 2631, 2629, 2628, 2626, 2624, 2623, 2621, 2619, 2618, 2616, 2614, 2613, 2611, 2610, 2608, 2606, 2605, 2603, 2601, 2600, 2598, 2597, 2595, 2593, 2592, 2590, 2589, 2587, 2585, 2584, 2582, 2581, 2579, 2577, 2576, 2574, 2573, 2571, 2570, 2568, 2566, 2565, 2563, 2562, 2560, 2559, 2557, 2555, 2554, 2552, 2551, 2549, 2548, 2546, 2545, 2543, 2542, 2540, 2538, 2537, 2535, 2534, 2532, 2531, 2529, 2528, 2526, 2525, 2523, 2522, 2520, 2519, 2517, 2516, 2514, 2513, 2511, 2510, 2508, 2507, 2505, 2504, 2502, 2501, 2499, 2498, 2496, 2495, 2493, 2492, 2490, 2489, 2487, 2486, 2484, 2483, 2481, 2480, 2478, 2477, 2475, 2474, 2473, 2471, 2470, 2468, 2467, 2465, 2464, 2462, 2461, 2460, 2458, 2457, 2455, 2454, 2452, 2451, 2449, 2448, 2447, 2445, 2444, 2442, 2441, 2439, 2438, 2437, 2435, 2434, 2432, 2431, 2430, 2428, 2427, 2425, 2424, 2423, 2421, 2420, 2418, 2417, 2416, 2414, 2413, 2411, 2410, 2409, 2407, 2406, 2404, 2403, 2402, 2400, 2399, 2398, 2396, 2395, 2394, 2392, 2391, 2389, 2388, 2387, 2385, 2384, 2383, 2381, 2380, 2379, 2377, 2376, 2375, 2373, 2372, 2371, 2369, 2368, 2366, 2365, 2364, 2362, 2361, 2360, 2359, 2357, 2356, 2355, 2353, 2352, 2351, 2349, 2348, 2347, 2345, 2344, 2343, 2341, 2340, 2339, 2337, 2336, 2335, 2334, 2332, 2331, 2330, 2328, 2327, 2326, 2325, 2323, 2322, 2321, 2319, 2318, 2317, 2316, 2314, 2313, 2312, 2310, 2309, 2308, 2307, 2305, 2304, 2303, 2302, 2300, 2299, 2298, 2296, 2295, 2294, 2293, 2291, 2290, 2289, 2288, 2286, 2285, 2284, 2283, 2281, 2280, 2279, 2278, 2277, 2275, 2274, 2273, 2272, 2270, 2269, 2268, 2267, 2265, 2264, 2263, 2262, 2261, 2259, 2258, 2257, 2256, 2255, 2253, 2252, 2251, 2250, 2248, 2247, 2246, 2245, 2244, 2242, 2241, 2240, 2239, 2238, 2236, 2235, 2234, 2233, 2232, 2231, 2229, 2228, 2227, 2226, 2225, 2223, 2222, 2221, 2220, 2219, 2218, 2216, 2215, 2214, 2213, 2212, 2211, 2209, 2208, 2207, 2206, 2205, 2204, 2202, 2201, 2200, 2199, 2198, 2197, 2195, 2194, 2193, 2192, 2191, 2190, 2189, 2187, 2186, 2185, 2184, 2183, 2182, 2181, 2179, 2178, 2177, 2176, 2175, 2174, 2173, 2172, 2170, 2169, 2168, 2167, 2166, 2165, 2164, 2163, 2162, 2160, 2159, 2158, 2157, 2156, 2155, 2154, 2153, 2152, 2150, 2149, 2148, 2147, 2146, 2145, 2144, 2143, 2142, 2141, 2139, 2138, 2137, 2136, 2135, 2134, 2133, 2132, 2131, 2130, 2129, 2128, 2126, 2125, 2124, 2123, 2122, 2121, 2120, 2119, 2118, 2117, 2116, 2115, 2114, 2112, 2111, 2110, 2109, 2108, 2107, 2106, 2105, 2104, 2103, 2102, 2101, 2100, 2099, 2098, 2097, 2096, 2095, 2094, 2092, 2091, 2090, 2089, 2088, 2087, 2086, 2085, 2084, 2083, 2082, 2081, 2080, 2079, 2078, 2077, 2076, 2075, 2074, 2073, 2072, 2071, 2070, 2069, 2068, 2067, 2066, 2065, 2064, 2063, 2062, 2061, 2060, 2059, 2058, 2057, 2056, 2055, 2054, 2053, 2052, 2051, 2050, 2049, 2048, 2047, 2046, 2045, 2044, 2043, 2042, 2041, 2040, 2039, 2038, 2037, 2036, 2035, 2034, 2033, 2032, 2031, 2030, 2029, 2028, 2027, 2026, 2025, 2024, 2023, 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006, 2005, 2004, 2003, 2003, 2002, 2001, 2000, 1999, 1998, 1997, 1996, 1995, 1994, 1993, 1992, 1991, 1990, 1989, 1988, 1987, 1986, 1985, 1984, 1984, 1983, 1982, 1981, 1980, 1979, 1978, 1977, 1976, 1975, 1974, 1973, 1972, 1971, 1971, 1970, 1969, 1968, 1967, 1966, 1965, 1964, 1963, 1962, 1961, 1960, 1959, 1959, 1958, 1957, 1956, 1955, 1954, 1953, 1952, 1951, 1950, 1949, 1949, 1948, 1947, 1946, 1945, 1944, 1943, 1942, 1941, 1940, 1940, 1939, 1938, 1937, 1936, 1935, 1934, 1933, 1932, 1931, 1931, 1930, 1929, 1928, 1927, 1926, 1925, 1924, 1923, 1923, 1922, 1921, 1920, 1919, 1918, 1917, 1916, 1916, 1915, 1914, 1913, 1912, 1911, 1910, 1909, 1909, 1908, 1907, 1906, 1905, 1904, 1903, 1903, 1902, 1901, 1900, 1899, 1898, 1897, 1897, 1896, 1895, 1894, 1893, 1892, 1891, 1891, 1890, 1889, 1888, 1887, 1886, 1885, 1885, 1884, 1883, 1882, 1881, 1880, 1880, 1879, 1878, 1877, 1876, 1875, 1874, 1874, 1873, 1872, 1871, 1870, 1869, 1869, 1868, 1867, 1866, 1865, 1864, 1864, 1863, 1862, 1861, 1860, 1860, 1859, 1858, 1857, 1856, 1855, 1855, 1854, 1853, 1852, 1851, 1850, 1850, 1849, 1848, 1847, 1846, 1846, 1845, 1844, 1843, 1842, 1842, 1841, 1840, 1839, 1838, 1837, 1837, 1836, 1835, 1834, 1833, 1833, 1832, 1831, 1830, 1829, 1829, 1828, 1827, 1826, 1825, 1825, 1824, 1823, 1822, 1822, 1821, 1820, 1819, 1818, 1818, 1817, 1816, 1815, 1814, 1814, 1813, 1812, 1811, 1811, 1810, 1809, 1808, 1807, 1807, 1806, 1805, 1804, 1804, 1803, 1802, 1801, 1800, 1800, 1799, 1798, 1797, 1797, 1796, 1795, 1794, 1793, 1793, 1792, 1791, 1790, 1790, 1789, 1788, 1787, 1787, 1786, 1785, 1784, 1784, 1783, 1782, 1781, 1781, 1780, 1779, 1778, 1778, 1777, 1776, 1775, 1774, 1774, 1773, 1772, 1771, 1771, 1770, 1769, 1769, 1768, 1767, 1766, 1766, 1765, 1764, 1763, 1763, 1762, 1761, 1760, 1760, 1759, 1758, 1757, 1757, 1756, 1755, 1754, 1754, 1753, 1752, 1752, 1751, 1750, 1749, 1749, 1748, 1747, 1746, 1746, 1745, 1744, 1743, 1743, 1742, 1741, 1741, 1740, 1739, 1738, 1738, 1737, 1736, 1736, 1735, 1734, 1733, 1733, 1732, 1731, 1731, 1730, 1729, 1728, 1728, 1727, 1726, 1726, 1725, 1724, 1723, 1723, 1722, 1721, 1721, 1720, 1719, 1718, 1718, 1717, 1716, 1716, 1715, 1714, 1714, 1713, 1712, 1711, 1711, 1710, 1709, 1709, 1708, 1707, 1707, 1706, 1705, 1705, 1704, 1703, 1702, 1702, 1701, 1700, 1700, 1699, 1698, 1698, 1697, 1696, 1696, 1695, 1694, 1693, 1693, 1692, 1691, 1691, 1690, 1689, 1689, 1688, 1687, 1687, 1686, 1685, 1685, 1684, 1683, 1683, 1682, 1681, 1681, 1680, 1679, 1679, 1678, 1677, 1677, 1676, 1675, 1675, 1674, 1673, 1673, 1672, 1671, 1671, 1670, 1669, 1669, 1668, 1667, 1667, 1666, 1665, 1665, 1664, 1663, 1663, 1662, 1661, 1661, 1660, 1659, 1659, 1658, 1657, 1657, 1656, 1655, 1655, 1654, 1653, 1653, 1652, 1651, 1651, 1650, 1650, 1649, 1648, 1648, 1647, 1646, 1646, 1645, 1644, 1644, 1643, 1642, 1642, 1641, 1640, 1640, 1639, 1639, 1638, 1637, 1637, 1636, 1635, 1635, 1634, 1633, 1633, 1632, 1632, 1631, 1630, 1630, 1629, 1628, 1628, 1627, 1626, 1626, 1625, 1625, 1624, 1623, 1623, 1622, 1621, 1621, 1620, 1620, 1619, 1618, 1618, 1617, 1616, 1616, 1615, 1615, 1614, 1613, 1613, 1612, 1611, 1611, 1610, 1610, 1609, 1608, 1608, 1607, 1607, 1606, 1605, 1605, 1604, 1603, 1603, 1602, 1602, 1601, 1600, 1600, 1599, 1599, 1598, 1597, 1597, 1596, 1596, 1595, 1594, 1594, 1593, 1592, 1592, 1591, 1591, 1590, 1589, 1589, 1588, 1588, 1587, 1586, 1586, 1585, 1585, 1584, 1583, 1583, 1582, 1582, 1581, 1580, 1580, 1579, 1579, 1578, 1577, 1577, 1576, 1576, 1575, 1575, 1574, 1573, 1573, 1572, 1572, 1571, 1570, 1570, 1569, 1569, 1568, 1567, 1567, 1566, 1566, 1565, 1565, 1564, 1563, 1563, 1562, 1562, 1561, 1560, 1560, 1559, 1559, 1558, 1558, 1557, 1556, 1556, 1555, 1555, 1554, 1554, 1553, 1552, 1552, 1551, 1551, 1550, 1550, 1549, 1548, 1548, 1547, 1547, 1546, 1546, 1545, 1544, 1544, 1543, 1543, 1542, 1542, 1541, 1540, 1540, 1539, 1539, 1538, 1538, 1537, 1536, 1536, 1535, 1535, 1534, 1534, 1533, 1533, 1532, 1531, 1531, 1530, 1530, 1529, 1529, 1528, 1527, 1527, 1526, 1526, 1525, 1525, 1524, 1524, 1523, 1522, 1522, 1521, 1521, 1520, 1520, 1519, 1519, 1518, 1518, 1517, 1516, 1516, 1515, 1515, 1514, 1514, 1513, 1513, 1512, 1512, 1511, 1510, 1510, 1509, 1509, 1508, 1508, 1507, 1507, 1506, 1506, 1505, 1504, 1504, 1503, 1503, 1502, 1502, 1501, 1501, 1500, 1500, 1499, 1499, 1498, 1497, 1497, 1496, 1496, 1495, 1495, 1494, 1494, 1493, 1493, 1492, 1492, 1491, 1491, 1490, 1489, 1489, 1488, 1488, 1487, 1487, 1486, 1486, 1485, 1485, 1484, 1484, 1483, 1483, 1482, 1482, 1481, 1481, 1480, 1479, 1479, 1478, 1478, 1477, 1477, 1476, 1476, 1475, 1475, 1474, 1474, 1473, 1473, 1472, 1472, 1471, 1471, 1470, 1470, 1469, 1469, 1468, 1468, 1467, 1467, 1466, 1466, 1465, 1465, 1464, 1463, 1463, 1462, 1462, 1461, 1461, 1460, 1460, 1459, 1459, 1458, 1458, 1457, 1457, 1456, 1456, 1455, 1455, 1454, 1454, 1453, 1453, 1452, 1452, 1451, 1451, 1450, 1450, 1449, 1449, 1448, 1448, 1447, 1447, 1446, 1446, 1445, 1445, 1444, 1444, 1443, 1443, 1442, 1442, 1441, 1441, 1440, 1440, 1439, 1439, 1438, 1438, 1437, 1437, 1436, 1436, 1435, 1435, 1434, 1434, 1433, 1433, 1432, 1432, 1431, 1431, 1431, 1430, 1430, 1429, 1429, 1428, 1428, 1427, 1427, 1426, 1426, 1425, 1425, 1424, 1424, 1423, 1423, 1422, 1422, 1421, 1421, 1420, 1420, 1419, 1419, 1418, 1418, 1417, 1417, 1416, 1416, 1416, 1415, 1415, 1414, 1414, 1413, 1413, 1412, 1412, 1411, 1411, 1410, 1410, 1409, 1409, 1408, 1408, 1407, 1407, 1407, 1406, 1406, 1405, 1405, 1404, 1404, 1403, 1403, 1402, 1402, 1401, 1401, 1400, 1400, 1399, 1399, 1399, 1398, 1398, 1397, 1397, 1396, 1396, 1395, 1395, 1394, 1394, 1393, 1393, 1392, 1392, 1392, 1391, 1391, 1390, 1390, 1389, 1389, 1388, 1388, 1387, 1387, 1387, 1386, 1386, 1385, 1385, 1384, 1384, 1383, 1383, 1382, 1382, 1381, 1381, 1381, 1380, 1380, 1379, 1379, 1378, 1378, 1377, 1377, 1376, 1376, 1376, 1375, 1375, 1374, 1374, 1373, 1373, 1372, 1372, 1372, 1371, 1371, 1370, 1370, 1369, 1369, 1368, 1368, 1368, 1367, 1367, 1366, 1366, 1365, 1365, 1364, 1364, 1364, 1363, 1363, 1362, 1362, 1361, 1361, 1360, 1360, 1360, 1359, 1359, 1358, 1358, 1357, 1357, 1356, 1356, 1356, 1355, 1355, 1354, 1354, 1353, 1353, 1353, 1352, 1352, 1351, 1351, 1350, 1350, 1349, 1349, 1349, 1348, 1348, 1347, 1347, 1346, 1346, 1346, 1345, 1345, 1344, 1344, 1343, 1343, 1343, 1342, 1342, 1341, 1341, 1340, 1340, 1340, 1339, 1339, 1338, 1338, 1337, 1337, 1337, 1336, 1336, 1335, 1335, 1334, 1334, 1334, 1333, 1333, 1332, 1332, 1331, 1331, 1331, 1330, 1330, 1329, 1329, 1328, 1328, 1328, 1327, 1327, 1326, 1326, 1326, 1325, 1325, 1324, 1324, 1323, 1323, 1323, 1322, 1322, 1321, 1321, 1321, 1320, 1320, 1319, 1319, 1318, 1318, 1318, 1317, 1317, 1316, 1316, 1316, 1315, 1315, 1314, 1314, 1314, 1313, 1313, 1312, 1312, 1311, 1311, 1311, 1310, 1310, 1309, 1309, 1309, 1308, 1308, 1307, 1307, 1307, 1306, 1306, 1305, 1305, 1305, 1304, 1304, 1303, 1303, 1302, 1302, 1302, 1301, 1301, 1300, 1300, 1300, 1299, 1299, 1298, 1298, 1298, 1297, 1297, 1296, 1296, 1296, 1295, 1295, 1294, 1294, 1294, 1293, 1293, 1292, 1292, 1292, 1291, 1291, 1290, 1290, 1290, 1289, 1289, 1288, 1288, 1288, 1287, 1287, 1286, 1286, 1286, 1285, 1285, 1285, 1284, 1284, 1283, 1283, 1283, 1282, 1282, 1281, 1281, 1281, 1280, 1280, 1279, 1279, 1279, 1278, 1278, 1277, 1277, 1277, 1276, 1276, 1276, 1275, 1275, 1274, 1274, 1274, 1273, 1273, 1272, 1272, 1272, 1271, 1271, 1271, 1270, 1270, 1269, 1269, 1269, 1268, 1268, 1267, 1267, 1267, 1266, 1266, 1266, 1265, 1265, 1264, 1264, 1264, 1263, 1263, 1262, 1262, 1262, 1261, 1261, 1261, 1260, 1260, 1259, 1259, 1259, 1258, 1258, 1258, 1257, 1257, 1256, 1256, 1256, 1255, 1255, 1255, 1254, 1254, 1253, 1253, 1253, 1252, 1252, 1252, 1251, 1251, 1250, 1250, 1250, 1249, 1249, 1249, 1248, 1248, 1247, 1247, 1247, 1246, 1246, 1246, 1245, 1245, 1244, 1244, 1244, 1243, 1243, 1243, 1242, 1242, 1242, 1241, 1241, 1240, 1240, 1240, 1239, 1239, 1239, 1238, 1238, 1237, 1237, 1237, 1236, 1236, 1236, 1235, 1235, 1235, 1234, 1234, 1233, 1233, 1233, 1232, 1232, 1232, 1231, 1231, 1231, 1230, 1230, 1230, 1229, 1229, 1228, 1228, 1228, 1227, 1227, 1227, 1226, 1226, 1226, 1225, 1225, 1224, 1224, 1224, 1223, 1223, 1223, 1222, 1222, 1222, 1221, 1221, 1221, 1220, 1220, 1219, 1219, 1219, 1218, 1218, 1218, 1217, 1217, 1217, 1216, 1216, 1216, 1215, 1215, 1215, 1214, 1214, 1213, 1213, 1213, 1212, 1212, 1212, 1211, 1211, 1211, 1210, 1210, 1210, 1209, 1209, 1209, 1208, 1208, 1208, 1207, 1207, 1206, 1206, 1206, 1205, 1205, 1205, 1204, 1204, 1204, 1203, 1203, 1203, 1202, 1202, 1202, 1201, 1201, 1201, 1200, 1200, 1200, 1199, 1199, 1199, 1198, 1198, 1198, 1197, 1197, 1197, 1196, 1196, 1195, 1195, 1195, 1194, 1194, 1194, 1193, 1193, 1193, 1192, 1192, 1192, 1191, 1191, 1191, 1190, 1190, 1190, 1189, 1189, 1189, 1188, 1188, 1188, 1187, 1187, 1187, 1186, 1186, 1186, 1185, 1185, 1185, 1184, 1184, 1184, 1183, 1183, 1183, 1182, 1182, 1182, 1181, 1181, 1181, 1180, 1180, 1180, 1179, 1179, 1179, 1178, 1178, 1178, 1177, 1177, 1177, 1176, 1176, 1176, 1175, 1175, 1175, 1174, 1174, 1174, 1173, 1173, 1173, 1172, 1172, 1172, 1171, 1171, 1171, 1170, 1170, 1170, 1169, 1169, 1169, 1168, 1168, 1168, 1168, 1167, 1167, 1167, 1166, 1166, 1166, 1165, 1165, 1165, 1164, 1164, 1164, 1163, 1163, 1163, 1162, 1162, 1162, 1161, 1161, 1161, 1160, 1160, 1160, 1159, 1159, 1159, 1158, 1158, 1158, 1158, 1157, 1157, 1157, 1156, 1156, 1156, 1155, 1155, 1155, 1154, 1154, 1154, 1153, 1153, 1153, 1152, 1152, 1152, 1151, 1151, 1151, 1151, 1150, 1150, 1150, 1149, 1149, 1149, 1148, 1148, 1148, 1147, 1147, 1147, 1146, 1146, 1146, 1145, 1145, 1145, 1145, 1144, 1144, 1144, 1143, 1143, 1143, 1142, 1142, 1142, 1141, 1141, 1141, 1140, 1140, 1140, 1140, 1139, 1139, 1139, 1138, 1138, 1138, 1137, 1137, 1137, 1136, 1136, 1136, 1136, 1135, 1135, 1135, 1134, 1134, 1134, 1133, 1133, 1133, 1132, 1132, 1132, 1132, 1131, 1131, 1131, 1130, 1130, 1130, 1129, 1129, 1129, 1129, 1128, 1128, 1128, 1127, 1127, 1127, 1126, 1126, 1126, 1125, 1125, 1125, 1125, 1124, 1124, 1124, 1123, 1123, 1123, 1122, 1122, 1122, 1122, 1121, 1121, 1121, 1120, 1120, 1120, 1119, 1119, 1119, 1119, 1118, 1118, 1118, 1117, 1117, 1117, 1116, 1116, 1116, 1116, 1115, 1115, 1115, 1114, 1114, 1114, 1114, 1113, 1113, 1113, 1112, 1112, 1112, 1111, 1111, 1111, 1111, 1110, 1110, 1110, 1109, 1109, 1109, 1109, 1108, 1108, 1108, 1107, 1107, 1107, 1106, 1106, 1106, 1106, 1105, 1105, 1105, 1104, 1104, 1104, 1104, 1103, 1103, 1103, 1102, 1102, 1102, 1102, 1101, 1101, 1101, 1100, 1100, 1100, 1100, 1099, 1099, 1099, 1098, 1098, 1098, 1097, 1097, 1097, 1097, 1096, 1096, 1096, 1095, 1095, 1095, 1095, 1094, 1094, 1094, 1093, 1093, 1093, 1093, 1092, 1092, 1092, 1091, 1091, 1091, 1091, 1090, 1090, 1090, 1089, 1089, 1089, 1089, 1088, 1088, 1088, 1088, 1087, 1087, 1087, 1086, 1086, 1086, 1086, 1085, 1085, 1085, 1084, 1084, 1084, 1084, 1083, 1083, 1083, 1082, 1082, 1082, 1082, 1081, 1081, 1081, 1081, 1080, 1080, 1080, 1079, 1079, 1079, 1079, 1078, 1078, 1078, 1077, 1077, 1077, 1077, 1076, 1076, 1076, 1076, 1075, 1075, 1075, 1074, 1074, 1074, 1074, 1073, 1073, 1073, 1072, 1072, 1072, 1072, 1071, 1071, 1071, 1071, 1070, 1070, 1070, 1069, 1069, 1069, 1069, 1068, 1068, 1068, 1068, 1067, 1067, 1067, 1066, 1066, 1066, 1066, 1065, 1065, 1065, 1065, 1064, 1064, 1064, 1064, 1063, 1063, 1063, 1062, 1062, 1062, 1062, 1061, 1061, 1061, 1061, 1060, 1060, 1060, 1059, 1059, 1059, 1059, 1058, 1058, 1058, 1058, 1057, 1057, 1057, 1057, 1056, 1056, 1056, 1055, 1055, 1055, 1055, 1054, 1054, 1054, 1054, 1053, 1053, 1053, 1053, 1052, 1052, 1052, 1051, 1051, 1051, 1051, 1050, 1050, 1050, 1050, 1049, 1049, 1049, 1049, 1048, 1048, 1048, 1048, 1047, 1047, 1047, 1047, 1046, 1046, 1046, 1045, 1045, 1045, 1045, 1044, 1044, 1044, 1044, 1043, 1043, 1043, 1043, 1042, 1042, 1042, 1042, 1041, 1041, 1041, 1041, 1040, 1040, 1040, 1039, 1039, 1039, 1039, 1038, 1038, 1038, 1038, 1037, 1037, 1037, 1037, 1036, 1036, 1036, 1036, 1035, 1035, 1035, 1035, 1034, 1034, 1034, 1034, 1033, 1033, 1033, 1033, 1032, 1032, 1032, 1032, 1031, 1031, 1031, 1031, 1030, 1030, 1030, 1030, 1029, 1029, 1029, 1029, 1028, 1028, 1028, 1028, 1027, 1027, 1027, 1027, 1026, 1026, 1026, 1026, 1025, 1025, 1025, 1025, 1024, 1024, 1024, 1024, 1023, 1023, 1023, 1023, 1022, 1022, 1022, 1022, 1021, 1021, 1021, 1021, 1020, 1020, 1020, 1020, 1019, 1019, 1019, 1019, 1018, 1018, 1018, 1018, 1017, 1017, 1017, 1017, 1016, 1016, 1016, 1016, 1015, 1015, 1015, 1015, 1014, 1014, 1014, 1014, 1013, 1013, 1013, 1013, 1012, 1012, 1012, 1012, 1011, 1011, 1011, 1011, 1010, 1010, 1010, 1010, 1009, 1009, 1009, 1009, 1008, 1008, 1008, 1008, 1008, 1007, 1007, 1007, 1007, 1006, 1006, 1006, 1006, 1005, 1005, 1005, 1005, 1004, 1004, 1004, 1004, 1003, 1003, 1003, 1003, 1002, 1002, 1002, 1002, 1001, 1001, 1001, 1001, 1001, 1000, 1000, 1000, 1000, 999, 999, 999, 999, 998, 998, 998, 998, 997, 997, 997, 997, 996, 996, 996, 996, 996, 995, 995, 995, 995, 994, 994, 994, 994, 993, 993, 993, 993, 992, 992, 992, 992, 992, 991, 991, 991, 991, 990, 990, 990, 990, 989, 989, 989, 989, 988, 988, 988, 988, 988, 987, 987, 987, 987, 986, 986, 986, 986, 985, 985, 985, 985, 985, 984, 984, 984, 984, 983, 983, 983, 983, 982, 982, 982, 982, 982, 981, 981, 981, 981, 980, 980, 980, 980, 979, 979, 979, 979, 979, 978, 978, 978, 978, 977, 977, 977, 977, 977, 976, 976, 976, 976, 975, 975, 975, 975, 974, 974, 974, 974, 974, 973, 973, 973, 973, 972, 972, 972, 972, 972, 971, 971, 971, 971, 970, 970, 970, 970, 970, 969, 969, 969, 969, 968, 968, 968, 968, 967, 967, 967, 967, 967, 966, 966, 966, 966, 965, 965, 965, 965, 965, 964, 964, 964, 964, 963, 963, 963, 963, 963, 962, 962, 962, 962, 961, 961, 961, 961, 961, 960, 960, 960, 960, 960, 959, 959, 959, 959, 958, 958, 958, 958, 958, 957, 957, 957, 957, 956, 956, 956, 956, 956, 955, 955, 955, 955, 954, 954, 954, 954, 954, 953, 953, 953, 953, 953, 952, 952, 952, 952, 951, 951, 951, 951, 951, 950, 950, 950, 950, 950, 949, 949, 949, 949, 948, 948, 948, 948, 948, 947, 947, 947, 947, 947, 946, 946, 946, 946, 945, 945, 945, 945, 945, 944, 944, 944, 944, 944, 943, 943, 943, 943, 942, 942, 942, 942, 942, 941, 941, 941, 941, 941, 940, 940, 940, 940, 940, 939, 939, 939, 939, 938, 938, 938, 938, 938, 937, 937, 937, 937, 937, 936, 936, 936, 936, 936, 935, 935, 935, 935, 934, 934, 934, 934, 934, 933, 933, 933, 933, 933, 932, 932, 932, 932, 932, 931, 931, 931, 931, 931, 930, 930, 930, 930, 930, 929, 929, 929, 929, 928, 928, 928, 928, 928, 927, 927, 927, 927, 927, 926, 926, 926, 926, 926, 925, 925, 925, 925, 925, 924, 924, 924, 924, 924, 923, 923, 923, 923, 923, 922, 922, 922, 922, 922, 921, 921, 921, 921, 921, 920, 920, 920, 920, 920, 919, 919, 919, 919, 918, 918, 918, 918, 918, 917, 917, 917, 917, 917, 916, 916, 916, 916, 916, 915, 915, 915, 915, 915, 914, 914, 914, 914, 914, 913, 913, 913, 913, 913, 912, 912, 912, 912, 912, 912, 911, 911, 911, 911, 911, 910, 910, 910, 910, 910, 909, 909, 909, 909, 909, 908, 908, 908, 908, 908, 907, 907, 907, 907, 907, 906, 906, 906, 906, 906, 905, 905, 905, 905, 905, 904, 904, 904, 904, 904, 903, 903, 903, 903, 903, 902, 902, 902, 902, 902, 902, 901, 901, 901, 901, 901, 900, 900, 900, 900, 900, 899, 899, 899, 899, 899, 898, 898, 898, 898, 898, 897, 897, 897, 897, 897, 896, 896, 896, 896, 896, 896, 895, 895, 895, 895, 895, 894, 894, 894, 894, 894, 893, 893, 893, 893, 893, 892, 892, 892, 892, 892, 892, 891, 891, 891, 891, 891, 890, 890, 890, 890, 890, 889, 889, 889, 889, 889, 889, 888, 888, 888, 888, 888, 887, 887, 887, 887, 887, 886, 886, 886, 886, 886, 885, 885, 885, 885, 885, 885, 884, 884, 884, 884, 884, 883, 883, 883, 883, 883, 883, 882, 882, 882, 882, 882, 881, 881, 881, 881, 881, 880, 880, 880, 880, 880, 880, 879, 879, 879, 879, 879, 878, 878, 878, 878, 878, 878, 877, 877, 877, 877, 877, 876, 876, 876, 876, 876, 876, 875, 875, 875, 875, 875, 874, 874, 874, 874, 874, 873, 873, 873, 873, 873, 873, 872, 872, 872, 872, 872, 871, 871, 871, 871, 871, 871, 870, 870, 870, 870, 870, 870, 869, 869, 869, 869, 869, 868, 868, 868, 868, 868, 868, 867, 867, 867, 867, 867, 866, 866, 866, 866, 866, 866, 865, 865, 865, 865, 865, 864, 864, 864, 864, 864, 864, 863, 863, 863, 863, 863, 863, 862, 862, 862, 862, 862, 861, 861, 861, 861, 861, 861, 860, 860, 860, 860, 860, 860, 859, 859, 859, 859, 859, 858, 858, 858, 858, 858, 858, 857, 857, 857, 857, 857, 857, 856, 856, 856, 856, 856, 855, 855, 855, 855, 855, 855, 854, 854, 854, 854, 854, 854, 853, 853, 853, 853, 853, 853, 852, 852, 852, 852, 852, 851, 851, 851, 851, 851, 851, 850, 850, 850, 850, 850, 850, 849, 849, 849, 849, 849, 849, 848, 848, 848, 848, 848, 848, 847, 847, 847, 847, 847, 846, 846, 846, 846, 846, 846, 845, 845, 845, 845, 845, 845, 844, 844, 844, 844, 844, 844, 843, 843, 843, 843, 843, 843, 842, 842, 842, 842, 842, 842, 841, 841, 841, 841, 841, 841, 840, 840, 840, 840, 840, 840, 839, 839, 839, 839, 839, 839, 838, 838, 838, 838, 838, 838, 837, 837, 837, 837, 837, 837, 836, 836, 836, 836, 836, 836, 835, 835, 835, 835, 835, 835, 834, 834, 834, 834, 834, 834, 833, 833, 833, 833, 833, 833, 832, 832, 832, 832, 832, 832, 831, 831, 831, 831, 831, 831, 830, 830, 830, 830, 830, 830, 829, 829, 829, 829, 829, 829, 828, 828, 828, 828, 828, 828, 827, 827, 827, 827, 827, 827, 826, 826, 826, 826, 826, 826, 825, 825, 825, 825, 825, 825, 825, 824, 824, 824, 824, 824, 824, 823, 823, 823, 823, 823, 823, 822, 822, 822, 822, 822, 822, 821, 821, 821, 821, 821, 821, 820, 820, 820, 820, 820, 820, 820, 819, 819, 819, 819, 819, 819, 818, 818, 818, 818, 818, 818, 817, 817, 817, 817, 817, 817, 816, 816, 816, 816, 816, 816, 816, 815, 815, 815, 815, 815, 815, 814, 814, 814, 814, 814, 814, 813, 813, 813, 813, 813, 813, 813, 812, 812, 812, 812, 812, 812, 811, 811, 811, 811, 811, 811, 810, 810, 810, 810, 810, 810, 810, 809, 809, 809, 809, 809, 809, 808, 808, 808, 808, 808, 808, 807, 807, 807, 807, 807, 807, 807, 806, 806, 806, 806, 806, 806, 805, 805, 805, 805, 805, 805, 805, 804, 804, 804, 804, 804, 804, 803, 803, 803, 803, 803, 803, 803, 802, 802, 802, 802, 802, 802, 801, 801, 801, 801, 801, 801, 801, 800, 800, 800, 800, 800, 800, 799, 799, 799, 799, 799, 799, 799, 798, 798, 798, 798, 798, 798, 798, 797, 797, 797, 797, 797, 797, 796, 796, 796, 796, 796, 796, 796, 795, 795, 795, 795, 795, 795, 794, 794, 794, 794, 794, 794, 794, 793, 793, 793, 793, 793, 793, 793, 792, 792, 792, 792, 792, 792, 791, 791, 791, 791, 791, 791, 791, 790, 790, 790, 790, 790, 790, 790, 789, 789, 789, 789, 789, 789, 788, 788, 788, 788, 788, 788, 788, 787, 787, 787, 787, 787, 787, 787, 786, 786, 786, 786, 786, 786, 786, 785, 785, 785, 785, 785, 785, 785, 784, 784, 784, 784, 784, 784, 783, 783, 783, 783, 783, 783, 783, 782, 782, 782, 782, 782, 782, 782, 781, 781, 781, 781, 781, 781, 781, 780, 780, 780, 780, 780, 780, 780, 779, 779, 779, 779, 779, 779, 779, 778, 778, 778, 778, 778, 778, 778, 777, 777, 777, 777, 777, 777, 777, 776, 776, 776, 776, 776, 776, 776, 775, 775, 775, 775, 775, 775, 775, 774, 774, 774, 774, 774, 774, 773, 773, 773, 773, 773, 773, 773, 773, 772, 772, 772, 772, 772, 772, 772, 771, 771, 771, 771, 771, 771, 771, 770, 770, 770, 770, 770, 770, 770, 769, 769, 769, 769, 769, 769, 769, 768, 768, 768, 768, 768, 768, 768, 767, 767, 767, 767, 767, 767, 767, 766, 766, 766, 766, 766, 766, 766, 765, 765, 765, 765, 765, 765, 765, 764, 764, 764, 764, 764, 764, 764, 763, 763, 763, 763, 763, 763, 763, 763, 762, 762, 762, 762, 762, 762, 762, 761, 761, 761, 761, 761, 761, 761, 760, 760, 760, 760, 760, 760, 760, 759, 759, 759, 759, 759, 759, 759, 759, 758, 758, 758, 758, 758, 758, 758, 757, 757, 757, 757, 757, 757, 757, 756, 756, 756, 756, 756, 756, 756, 756, 755, 755, 755, 755, 755, 755, 755, 754, 754, 754, 754, 754, 754, 754, 753, 753, 753, 753, 753, 753, 753, 753, 752, 752, 752, 752, 752, 752, 752, 751, 751, 751, 751, 751, 751, 751, 750, 750, 750, 750, 750, 750, 750, 750, 749, 749, 749, 749, 749, 749, 749, 748, 748, 748, 748, 748, 748, 748, 748, 747, 747, 747, 747, 747, 747, 747, 746, 746, 746, 746, 746, 746, 746, 746, 745, 745, 745, 745, 745, 745, 745, 744, 744, 744, 744, 744, 744, 744, 744, 743, 743, 743, 743, 743, 743, 743, 743, 742, 742, 742, 742, 742, 742, 742, 741, 741, 741, 741, 741, 741, 741, 741, 740, 740, 740, 740, 740, 740, 740, 739, 739, 739, 739, 739, 739, 739, 739, 738, 738, 738, 738, 738, 738, 738, 738, 737, 737, 737, 737, 737, 737, 737, 737, 736, 736, 736, 736, 736, 736, 736, 735, 735, 735, 735, 735, 735, 735, 735, 734, 734, 734, 734, 734, 734, 734, 734, 733, 733, 733, 733, 733, 733, 733, 733, 732, 732, 732, 732, 732, 732, 732, 731, 731, 731, 731, 731, 731, 731, 731, 730, 730, 730, 730, 730, 730, 730, 730, 729, 729, 729, 729, 729, 729, 729, 729, 728, 728, 728, 728, 728, 728, 728, 728, 727, 727, 727, 727, 727, 727, 727, 727, 726, 726, 726, 726, 726, 726, 726, 726, 725, 725, 725, 725, 725, 725, 725, 725, 724, 724, 724, 724, 724, 724, 724, 724, 723, 723, 723, 723, 723, 723, 723, 723, 722, 722, 722, 722, 722, 722, 722, 722, 721, 721, 721, 721, 721, 721, 721, 721, 720, 720, 720, 720, 720, 720, 720, 720, 719, 719, 719, 719, 719, 719, 719, 719, 718, 718, 718, 718, 718, 718, 718, 718, 717, 717, 717, 717, 717, 717, 717, 717, 716, 716, 716, 716, 716, 716, 716, 716, 715, 715, 715, 715, 715, 715, 715, 715, 715, 714, 714, 714, 714, 714, 714, 714, 714, 713, 713, 713, 713, 713, 713, 713, 713, 712, 712, 712, 712, 712, 712, 712, 712, 711, 711, 711, 711, 711, 711, 711, 711, 711, 710, 710, 710, 710, 710, 710, 710, 710, 709, 709, 709, 709, 709, 709, 709, 709, 708, 708, 708, 708, 708, 708, 708, 708, 708, 707, 707, 707, 707, 707, 707, 707, 707, 706, 706, 706, 706, 706, 706, 706, 706, 705, 705, 705, 705, 705, 705, 705, 705, 705, 704, 704, 704, 704, 704, 704, 704, 704, 703, 703, 703, 703, 703, 703, 703, 703, 703, 702, 702, 702, 702, 702, 702, 702, 702, 701, 701, 701, 701, 701, 701, 701, 701, 701, 700, 700, 700, 700, 700, 700, 700, 700, 699, 699, 699, 699, 699, 699, 699, 699, 699, 698, 698, 698, 698, 698, 698, 698, 698, 698, 697, 697, 697, 697, 697, 697, 697, 697, 696, 696, 696, 696, 696, 696, 696, 696, 696, 695, 695, 695, 695, 695, 695, 695, 695, 694, 694, 694, 694, 694, 694, 694, 694, 694, 693, 693, 693, 693, 693, 693, 693, 693, 693, 692, 692, 692, 692, 692, 692, 692, 692, 692, 691, 691, 691, 691, 691, 691, 691, 691, 690, 690, 690, 690, 690, 690, 690, 690, 690, 689, 689, 689, 689, 689, 689, 689, 689, 689, 688, 688, 688, 688, 688, 688, 688, 688, 688, 687, 687, 687, 687, 687, 687, 687, 687, 687, 686, 686, 686, 686, 686, 686, 686, 686, 686, 685, 685, 685, 685, 685, 685, 685, 685, 685, 684, 684, 684, 684, 684, 684, 684, 684, 684, 683, 683, 683, 683, 683, 683, 683, 683, 683, 682, 682, 682, 682, 682, 682, 682, 682, 682, 681, 681, 681, 681, 681, 681, 681, 681, 681, 680, 680, 680, 680, 680, 680, 680, 680, 680, 679, 679, 679, 679, 679, 679, 679, 679, 679, 678, 678, 678, 678, 678, 678, 678, 678, 678, 677, 677, 677, 677, 677, 677, 677, 677, 677, 676, 676, 676, 676, 676, 676, 676, 676, 676, 675, 675, 675, 675, 675, 675, 675, 675, 675, 674, 674, 674, 674, 674, 674, 674, 674, 674, 674, 673, 673, 673, 673, 673, 673, 673, 673, 673, 672, 672, 672, 672, 672, 672, 672, 672, 672, 671, 671, 671, 671, 671, 671, 671, 671, 671, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 669, 669, 669, 669, 669, 669, 669, 669, 669, 668, 668, 668, 668, 668, 668, 668, 668, 668, 667, 667, 667, 667, 667, 667, 667, 667, 667, 667, 666, 666, 666, 666, 666, 666, 666, 666, 666, 665, 665, 665, 665, 665, 665, 665, 665, 665, 665, 664, 664, 664, 664, 664, 664, 664, 664, 664, 663, 663, 663, 663, 663, 663, 663, 663, 663, 663, 662, 662, 662, 662, 662, 662, 662, 662, 662, 661, 661, 661, 661, 661, 661, 661, 661, 661, 661, 660, 660, 660, 660, 660, 660, 660, 660, 660, 660, 659, 659, 659, 659, 659, 659, 659, 659, 659, 658, 658, 658, 658, 658, 658, 658, 658, 658, 658, 657, 657, 657, 657, 657, 657, 657, 657, 657, 657, 656, 656, 656, 656, 656, 656, 656, 656, 656, 655, 655, 655, 655, 655, 655, 655, 655, 655, 655, 654, 654, 654, 654, 654, 654, 654, 654, 654, 654, 653, 653, 653, 653, 653, 653, 653, 653, 653, 653, 652, 652, 652, 652, 652, 652, 652, 652, 652, 651, 651, 651, 651, 651, 651, 651, 651, 651, 651, 650, 650, 650, 650, 650, 650, 650, 650, 650, 650, 649, 649, 649, 649, 649, 649, 649, 649, 649, 649, 648, 648, 648, 648, 648, 648, 648, 648, 648, 648, 647, 647, 647, 647, 647, 647, 647, 647, 647, 647, 646, 646, 646, 646, 646, 646, 646, 646, 646, 646, 645, 645, 645, 645, 645, 645, 645, 645, 645, 645, 644, 644, 644, 644, 644, 644, 644, 644, 644, 644, 643, 643, 643, 643, 643, 643, 643, 643, 643, 643, 643, 642, 642, 642, 642, 642, 642, 642, 642, 642, 642, 641, 641, 641, 641, 641, 641, 641, 641, 641, 641, 640, 640, 640, 640, 640, 640, 640, 640, 640, 640, 639, 639, 639, 639, 639, 639, 639, 639, 639, 639, 638, 638, 638, 638, 638, 638, 638, 638, 638, 638, 638, 637, 637, 637, 637, 637, 637, 637, 637, 637, 637, 636, 636, 636, 636, 636, 636, 636, 636, 636, 636, 635, 635, 635, 635, 635, 635, 635, 635, 635, 635, 635, 634, 634, 634, 634, 634, 634, 634, 634, 634, 634, 633, 633, 633, 633, 633, 633, 633, 633, 633, 633, 633, 632, 632, 632, 632, 632, 632, 632, 632, 632, 632, 631, 631, 631, 631, 631, 631, 631, 631, 631, 631, 631, 630, 630, 630, 630, 630, 630, 630, 630, 630, 630, 629, 629, 629, 629, 629, 629, 629, 629, 629, 629, 629, 628, 628, 628, 628, 628, 628, 628, 628, 628, 628, 627, 627, 627, 627, 627, 627, 627, 627, 627, 627, 627, 626, 626, 626, 626, 626, 626, 626, 626, 626, 626, 626, 625, 625, 625, 625, 625, 625, 625, 625, 625, 625, 624, 624, 624, 624, 624, 624, 624, 624, 624, 624, 624, 623, 623, 623, 623, 623, 623, 623, 623, 623, 623, 623, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 621, 621, 621, 621, 621, 621, 621, 621, 621, 621, 621, 620, 620, 620, 620, 620, 620, 620, 620, 620, 620, 620, 619, 619, 619, 619, 619, 619, 619, 619, 619, 619, 618, 618, 618, 618, 618, 618, 618, 618, 618, 618, 618, 617, 617, 617, 617, 617, 617, 617, 617, 617, 617, 617, 616, 616, 616, 616, 616, 616, 616, 616, 616, 616, 616, 615, 615, 615, 615, 615, 615, 615, 615, 615, 615, 615, 615, 614, 614, 614, 614, 614, 614, 614, 614, 614, 614, 614, 613, 613, 613, 613, 613, 613, 613, 613, 613, 613, 613, 612, 612, 612, 612, 612, 612, 612, 612, 612, 612, 612, 611, 611, 611, 611, 611, 611, 611, 611, 611, 611, 611, 610, 610, 610, 610, 610, 610, 610, 610, 610, 610, 610, 609, 609, 609, 609, 609, 609, 609, 609, 609, 609, 609, 609, 608, 608, 608, 608, 608, 608, 608, 608, 608, 608, 608, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 606, 606, 606, 606, 606, 606, 606, 606, 606, 606, 606, 606, 605, 605, 605, 605, 605, 605, 605, 605, 605, 605, 605, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 603, 603, 603, 603, 603, 603, 603, 603, 603, 603, 603, 602, 602, 602, 602, 602, 602, 602, 602, 602, 602, 602, 602, 601, 601, 601, 601, 601, 601, 601, 601, 601, 601, 601, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 599, 599, 599, 599, 599, 599, 599, 599, 599, 599, 599, 599, 598, 598, 598, 598, 598, 598, 598, 598, 598, 598, 598, 597, 597, 597, 597, 597, 597, 597, 597, 597, 597, 597, 597, 596, 596, 596, 596, 596, 596, 596, 596, 596, 596, 596, 596, 595, 595, 595, 595, 595, 595, 595, 595, 595, 595, 595, 595, 594, 594, 594, 594, 594, 594, 594, 594, 594, 594, 594, 594, 593, 593, 593, 593, 593, 593, 593, 593, 593, 593, 593, 593, 592, 592, 592, 592, 592, 592, 592, 592, 592, 592, 592, 591, 591, 591, 591, 591, 591, 591, 591, 591, 591, 591, 591, 590, 590, 590, 590, 590, 590, 590, 590, 590, 590, 590, 590, 589, 589, 589, 589, 589, 589, 589, 589, 589, 589, 589, 589, 589, 588, 588, 588, 588, 588, 588, 588, 588, 588, 588, 588, 588, 587, 587, 587, 587, 587, 587, 587, 587, 587, 587, 587, 587, 586, 586, 586, 586, 586, 586, 586, 586, 586, 586, 586, 586, 585, 585, 585, 585, 585, 585, 585, 585, 585, 585, 585, 585, 584, 584, 584, 584, 584, 584, 584, 584, 584, 584, 584, 584, 584, 583, 583, 583, 583, 583, 583, 583, 583, 583, 583, 583, 583, 582, 582, 582, 582, 582, 582, 582, 582, 582, 582, 582, 582, 581, 581, 581, 581, 581, 581, 581, 581, 581, 581, 581, 581, 581, 580, 580, 580, 580, 580, 580, 580, 580, 580, 580, 580, 580, 579, 579, 579, 579, 579, 579, 579, 579, 579, 579, 579, 579, 579, 578, 578, 578, 578, 578, 578, 578, 578, 578, 578, 578, 578, 577, 577, 577, 577, 577, 577, 577, 577, 577, 577, 577, 577, 577, 576, 576, 576, 576, 576, 576, 576, 576, 576, 576, 576, 576, 575, 575, 575, 575, 575, 575, 575, 575, 575, 575, 575, 575, 575, 574, 574, 574, 574, 574, 574, 574, 574, 574, 574, 574, 574, 574, 573, 573, 573, 573, 573, 573, 573, 573, 573, 573, 573, 573, 572, 572, 572, 572, 572, 572, 572, 572, 572, 572, 572, 572, 572, 571, 571, 571, 571, 571, 571, 571, 571, 571, 571, 571, 571, 571, 570, 570, 570, 570, 570, 570, 570, 570, 570, 570, 570, 570, 570, 569, 569, 569, 569, 569, 569, 569, 569, 569, 569, 569, 569, 569, 568, 568, 568, 568, 568, 568, 568, 568, 568, 568, 568, 568, 568, 567, 567, 567, 567, 567, 567, 567, 567, 567, 567, 567, 567, 567, 566, 566, 566, 566, 566, 566, 566, 566, 566, 566, 566, 566, 566, 565, 565, 565, 565, 565, 565, 565, 565, 565, 565, 565, 565, 565, 564, 564, 564, 564, 564, 564, 564, 564, 564, 564, 564, 564, 564, 563, 563, 563, 563, 563, 563, 563, 563, 563, 563, 563, 563, 563, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 561, 560, 560, 560, 560, 560, 560, 560, 560, 560, 560, 560, 560, 560, 559, 559, 559, 559, 559, 559, 559, 559, 559, 559, 559, 559, 559, 559, 558, 558, 558, 558, 558, 558, 558, 558, 558, 558, 558, 558, 558, 557, 557, 557, 557, 557, 557, 557, 557, 557, 557, 557, 557, 557, 557, 556, 556, 556, 556, 556, 556, 556, 556, 556, 556, 556, 556, 556, 555, 555, 555, 555, 555, 555, 555, 555, 555, 555, 555, 555, 555, 555, 554, 554, 554, 554, 554, 554, 554, 554, 554, 554, 554, 554, 554, 553, 553, 553, 553, 553, 553, 553, 553, 553, 553, 553, 553, 553, 553, 552, 552, 552, 552, 552, 552, 552, 552, 552, 552, 552, 552, 552, 552, 551, 551, 551, 551, 551, 551, 551, 551, 551, 551, 551, 551, 551, 551, 550, 550, 550, 550, 550, 550, 550, 550, 550, 550, 550, 550, 550, 550, 549, 549, 549, 549, 549, 549, 549, 549, 549, 549, 549, 549, 549, 548, 548, 548, 548, 548, 548, 548, 548, 548, 548, 548, 548, 548, 548, 547, 547, 547, 547, 547, 547, 547, 547, 547, 547, 547, 547, 547, 547, 546, 546, 546, 546, 546, 546, 546, 546, 546, 546, 546, 546, 546, 546, 545, 545, 545, 545, 545, 545, 545, 545, 545, 545, 545, 545, 545, 545, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 543, 543, 543, 543, 543, 543, 543, 543, 543, 543, 543, 543, 543, 543, 542, 542, 542, 542, 542, 542, 542, 542, 542, 542, 542, 542, 542, 542, 541, 541, 541, 541, 541, 541, 541, 541, 541, 541, 541, 541, 541, 541, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 540, 539, 539, 539, 539, 539, 539, 539, 539, 539, 539, 539, 539, 539, 539, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 538, 537, 537, 537, 537, 537, 537, 537, 537, 537, 537, 537, 537, 537, 537, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 536, 535, 535, 535, 535, 535, 535, 535, 535, 535, 535, 535, 535, 535, 535, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 534, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 533, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 532, 531, 531, 531, 531, 531, 531, 531, 531, 531, 531, 531, 531, 531, 531, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 529, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 528, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 527, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 526, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 525, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 524, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 523, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 522, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 521, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 520, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 519, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 517, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 516, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 515, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 514, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 513, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 512, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 511, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 510, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 509, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 508, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 507, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 506, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 505, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, 504, };
+
+
+
+private:
+
+  static_vector<Pel, NN_MAX_BOUNDARY_SIZE> m_refSamplesY;
+  static_vector<Pel, NN_MAX_BOUNDARY_SIZE> m_refSamplesCb;
+  static_vector<Pel, NN_MAX_BOUNDARY_SIZE> m_refSamplesCr;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES> m_collocatedSamplesY;
+
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE> m_boundary1Pred;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES> m_padCollocatedSamplesY;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE> m_inputPatchesY;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE> m_padAttPred;
+
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE> m_attbPred;
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_CHANNEL_SIZE> m_attxPred;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES * NN_MAX_CHANNEL_SIZE> m_attx1Pred;
+  static_vector<long, NN_MAX_OUTPUT_SAMPLES> m_attSoftmax;
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_OUTPUT_SAMPLES> m_preAttMap;
+  static_vector<long, NN_MAX_BOUNDARY_SIZE * NN_MAX_OUTPUT_SAMPLES> m_attMap;
+
+  Size m_blockSize;
+  Size m_bound1Size;
+  Size m_bound2Size;
+  Size m_lumaSize;
+  Size m_attbSize;
+  Size m_attxSize;
+  Size m_attx1Size;
+  Size m_attMapSize;
+
+  void initPredBlockParams(const Size& block);
+};
+#endif
diff --git a/source/Lib/CommonLib/TypeDef.h b/source/Lib/CommonLib/TypeDef.h
index 1363c31..c5ba6bb 100644
--- a/source/Lib/CommonLib/TypeDef.h
+++ b/source/Lib/CommonLib/TypeDef.h
@@ -50,6 +50,12 @@
 #include <assert.h>
 #include <cassert>
 
+#define NN_CHROMA_PRED                                    1 // NN Intra Chroma Prediction
+#if NN_CHROMA_PRED
+#define NN_CHROMA_PRED_SIGNAL                             1 // NN Intra Chroma Prediction
+#define NN_CHROMA_PRED_SIGNAL_SEPARATE                    1
+#define NN_CHROMA_PRED_SIGNAL_REPLACE_TL                  0
+#endif
 #define RETRAIN_CABAC                                     1 // Retrained CABAC probabilities
 
 #define JVET_P01034_PRED_1D_SCALING_LIST                  1 // JVET-P1034: 1D Scaling list index and add predictor mode
diff --git a/source/Lib/CommonLib/UnitTools.cpp b/source/Lib/CommonLib/UnitTools.cpp
index 2e198dc..b7d6f32 100644
--- a/source/Lib/CommonLib/UnitTools.cpp
+++ b/source/Lib/CommonLib/UnitTools.cpp
@@ -550,7 +550,12 @@ void PU::getIntraChromaCandModes( const PredictionUnit &pu, unsigned modeList[NU
     modeList[4] = LM_CHROMA_IDX;
     modeList[5] = MDLM_L_IDX;
     modeList[6] = MDLM_T_IDX;
+#if NN_CHROMA_PRED_SIGNAL
+    modeList[7] = LM_CHROMA_NN;
+    modeList[8] = DM_CHROMA_IDX;
+#else
     modeList[7] = DM_CHROMA_IDX;
+#endif
 
     const uint32_t lumaMode = getCoLocatedIntraLumaMode(pu);
     for( int i = 0; i < 4; i++ )
@@ -564,9 +569,27 @@ void PU::getIntraChromaCandModes( const PredictionUnit &pu, unsigned modeList[NU
   }
 }
 
+#if NN_CHROMA_PRED_SIGNAL
+bool PU::isLMCNNenabled(const PredictionUnit &pu)
+{
+  CompArea areaCb = pu.Cb();
+  bool lmChromaNnEnabled = true;
+  if (!((areaCb.width == 4 && areaCb.height == 4) || (areaCb.width == 8 && areaCb.height == 8) || (areaCb.width == 16 && areaCb.height == 16)))
+  {
+    lmChromaNnEnabled = false;
+  }
+
+  return lmChromaNnEnabled;
+}
+#endif
+
 bool PU::isLMCMode(unsigned mode)
 {
+#if NN_CHROMA_PRED_SIGNAL
+  return (mode >= LM_CHROMA_IDX && mode <= LM_CHROMA_NN);
+#else
   return (mode >= LM_CHROMA_IDX && mode <= MDLM_T_IDX);
+#endif
 }
 
 bool PU::isLMCModeEnabled(const PredictionUnit &pu, unsigned mode)
@@ -583,6 +606,9 @@ int PU::getLMSymbolList(const PredictionUnit &pu, int *modeList)
   int idx = 0;
 
   modeList[idx++] = LM_CHROMA_IDX;
+#if NN_CHROMA_PRED_SIGNAL
+  modeList[idx++] = LM_CHROMA_NN;
+#endif
   modeList[idx++] = MDLM_L_IDX;
   modeList[idx++] = MDLM_T_IDX;
   return idx;
diff --git a/source/Lib/CommonLib/UnitTools.h b/source/Lib/CommonLib/UnitTools.h
index c40064f..9a2209b 100644
--- a/source/Lib/CommonLib/UnitTools.h
+++ b/source/Lib/CommonLib/UnitTools.h
@@ -185,6 +185,9 @@ namespace PU
 
   bool isLMCMode                      (                          unsigned mode);
   bool isLMCModeEnabled               (const PredictionUnit &pu, unsigned mode);
+#if NN_CHROMA_PRED_SIGNAL
+  bool isLMCNNenabled(const PredictionUnit &pu);
+#endif
   bool isChromaIntraModeCrossCheckMode(const PredictionUnit &pu);
   void getTriangleMergeCandidates     (const PredictionUnit &pu, MergeCtx &triangleMrgCtx);
   void spanTriangleMotionInfo         (      PredictionUnit &pu, MergeCtx &triangleMrgCtx, const bool splitDir, const uint8_t candIdx0, const uint8_t candIdx1);
diff --git a/source/Lib/DecoderLib/CABACReader.cpp b/source/Lib/DecoderLib/CABACReader.cpp
index 0f7937f..63fa265 100644
--- a/source/Lib/DecoderLib/CABACReader.cpp
+++ b/source/Lib/DecoderLib/CABACReader.cpp
@@ -1478,6 +1478,24 @@ bool CABACReader::intra_chroma_lmc_mode(PredictionUnit& pu)
   int lmModeList[10];
   PU::getLMSymbolList(pu, lmModeList);
 
+#if NN_CHROMA_PRED_SIGNAL
+  bool lmChromaNnEnabled = PU::isLMCNNenabled(pu);
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+  lmChromaNnEnabled = false;
+#endif
+
+  if (lmChromaNnEnabled)
+  {
+#if NN_CHROMA_PRED_SIGNAL_REPLACE_TL
+    int symbol = m_BinDecoder.decodeBin(Ctx::CclmModeIdx(0)) ? 1 : 0;
+#else
+    int symbol = m_BinDecoder.decodeBin(Ctx::CclmModeIdx(0)) ? 2 : 0;
+    symbol += m_BinDecoder.decodeBinEP();
+#endif
+    pu.intraDir[1] = lmModeList[symbol];
+    return true;
+  }
+#endif
 #if JVET_P0615_CHROMAMODE_CLEANUP
   int symbol = m_BinDecoder.decodeBin(Ctx::CclmModeIdx(0));
 #else
@@ -1491,8 +1509,30 @@ bool CABACReader::intra_chroma_lmc_mode(PredictionUnit& pu)
   }
   else
   {
+#if NN_CHROMA_PRED_SIGNAL
+    if (lmChromaNnEnabled)
+    {
+      symbol += m_BinDecoder.decodeBinEP();
+      if (symbol == 1)
+      {
+        pu.intraDir[1] = lmModeList[symbol];
+      }
+      else
+      {
+        symbol += m_BinDecoder.decodeBinEP();
+        pu.intraDir[1] = lmModeList[symbol];
+      }
+    }
+    else
+    {
+      symbol += m_BinDecoder.decodeBinEP();
+      symbol++;
+      pu.intraDir[1] = lmModeList[symbol];
+    }
+#else
     symbol += m_BinDecoder.decodeBinEP();
     pu.intraDir[1] = lmModeList[symbol];
+#endif
   }
   return true; //it will only enter this function for LMC modes, so always return true ;
 }
@@ -1512,6 +1552,19 @@ void CABACReader::intra_chroma_pred_mode(PredictionUnit& pu)
   }
 #endif
 
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+  if (PU::isLMCNNenabled(pu) && pu.cu->checkCCLMAllowed())
+  {
+    bool isLMCNnMode = m_BinDecoder.decodeBin(Ctx::CclmNnModeFlag(0)) ? true : false;
+    if (isLMCNnMode)
+    {
+      pu.intraDir[1] = LM_CHROMA_NN;//intra_chroma_lmc_mode(pu);
+      return;
+    }
+  }
+#endif
+
+
   if (pu.cs->sps->getUseLMChroma() && pu.cu->checkCCLMAllowed())
   {
     bool isLMCMode = m_BinDecoder.decodeBin(Ctx::CclmModeFlag(0)) ? true : false;
diff --git a/source/Lib/DecoderLib/DecCu.cpp b/source/Lib/DecoderLib/DecCu.cpp
index f56cb73..2f8e1db 100644
--- a/source/Lib/DecoderLib/DecCu.cpp
+++ b/source/Lib/DecoderLib/DecCu.cpp
@@ -235,7 +235,25 @@ void DecCu::xIntraRecBlk( TransformUnit& tu, const ComponentID compID )
   {
     const PredictionUnit& pu = *tu.cu->firstPU;
     m_pcIntraPred->xGetLumaRecPixels( pu, area );
-    m_pcIntraPred->predIntraChromaLM( compID, piPred, pu, area, uiChFinalMode );
+#if NN_CHROMA_PRED
+    // Apply NN Intra Chroma prediction only for 8x8 blocks
+#if NN_CHROMA_PRED_SIGNAL
+    if (uiChFinalMode == LM_CHROMA_NN)
+#else
+    if (((area.width == 4 && area.height == 4) || (area.width == 8 && area.height == 8) || (area.width == 16 && area.height == 16)) && uiChFinalMode == LM_CHROMA_IDX)
+#endif
+    {
+      m_pcIntraPred->initIntraPatternChType(*tu.cu, tu.blocks[COMPONENT_Cr]);
+      m_pcIntraPred->initNNIntraChroma(pu, area);
+      m_pcIntraPred->predIntraNN(piPred, piPred, pu, compID, pu.cs->slice->clpRng(compID));
+    }
+    else
+    {
+      m_pcIntraPred->predIntraChromaLM(compID, piPred, pu, area, uiChFinalMode);
+    }
+#else
+    m_pcIntraPred->predIntraChromaLM(compID, piPred, pu, area, uiChFinalMode);
+#endif
   }
   else
   {
diff --git a/source/Lib/EncoderLib/CABACWriter.cpp b/source/Lib/EncoderLib/CABACWriter.cpp
index 7c33444..1e0d0de 100644
--- a/source/Lib/EncoderLib/CABACWriter.cpp
+++ b/source/Lib/EncoderLib/CABACWriter.cpp
@@ -1222,6 +1222,26 @@ void CABACWriter::intra_chroma_lmc_mode(const PredictionUnit& pu)
       break;
     }
   }
+#if NN_CHROMA_PRED_SIGNAL
+  bool lmChromaNnEnabled = PU::isLMCNNenabled(pu);
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+  lmChromaNnEnabled = false;
+#endif
+  //we need to get our size. if it is not allowed to do LM NN, we do:
+  if(!lmChromaNnEnabled)
+    symbol = symbol? symbol - 1 : symbol;
+  else
+  {
+#if NN_CHROMA_PRED_SIGNAL_REPLACE_TL
+    m_BinEncoder.encodeBin(symbol == 0 ? 0 : 1, Ctx::CclmModeIdx(0));
+#else
+    m_BinEncoder.encodeBin(symbol <= 1 ? 0 : 1, Ctx::CclmModeIdx(0));
+    unsigned int second_bin = (symbol == 1 || symbol == 3);
+    m_BinEncoder.encodeBinEP(second_bin);
+#endif
+    return;
+  }
+#endif
   CHECK(symbol < 0, "invalid symbol found");
 
 #if JVET_P0615_CHROMAMODE_CLEANUP
@@ -1232,9 +1252,29 @@ void CABACWriter::intra_chroma_lmc_mode(const PredictionUnit& pu)
 
   if (symbol > 0)
   {
+#if NN_CHROMA_PRED_SIGNAL
+    if (lmChromaNnEnabled)
+    {
+      CHECK(symbol > 3, "invalid symbol for MMLM");
+      unsigned int symbol_minus_1 = symbol - 1;
+      m_BinEncoder.encodeBinEP(symbol_minus_1);
+      if (symbol_minus_1)
+      {
+        unsigned int symbol_minus_2 = symbol - 2;
+        m_BinEncoder.encodeBinEP(symbol_minus_2);
+      }
+    }
+    else
+    {
+      CHECK(symbol > 2, "invalid symbol for MMLM");
+      unsigned int symbol_minus_1 = symbol - 1;
+      m_BinEncoder.encodeBinEP(symbol_minus_1);
+    }
+#else
     CHECK(symbol > 2, "invalid symbol for MMLM");
     unsigned int symbol_minus_1 = symbol - 1;
     m_BinEncoder.encodeBinEP(symbol_minus_1);
+#endif
   }
 }
 
@@ -1249,10 +1289,27 @@ void CABACWriter::intra_chroma_pred_mode(const PredictionUnit& pu)
 #endif
 
   const unsigned intraDir = pu.intraDir[1];
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+  if (PU::isLMCNNenabled(pu) && pu.cu->checkCCLMAllowed())
+  {
+    bool isLMCNnMode = (pu.intraDir[1] == LM_CHROMA_NN);
+    m_BinEncoder.encodeBin(isLMCNnMode ? 1 : 0, Ctx::CclmNnModeFlag(0));
+    if (isLMCNnMode)
+    {
+      return;
+    }
+  }
+#endif
   if (pu.cs->sps->getUseLMChroma() && pu.cu->checkCCLMAllowed())
   {
+#if NN_CHROMA_PRED_SIGNAL_SEPARATE
+    bool isCCLM = PU::isLMCMode(intraDir) && !(pu.intraDir[1] == LM_CHROMA_NN);
+    m_BinEncoder.encodeBin(isCCLM ? 1 : 0, Ctx::CclmModeFlag(0));
+    if (isCCLM)
+#else
     m_BinEncoder.encodeBin(PU::isLMCMode(intraDir) ? 1 : 0, Ctx::CclmModeFlag(0));
     if (PU::isLMCMode(intraDir))
+#endif
     {
       intra_chroma_lmc_mode(pu);
       return;
diff --git a/source/Lib/EncoderLib/EncModeCtrl.cpp b/source/Lib/EncoderLib/EncModeCtrl.cpp
index 56da31c..cc87786 100644
--- a/source/Lib/EncoderLib/EncModeCtrl.cpp
+++ b/source/Lib/EncoderLib/EncModeCtrl.cpp
@@ -1452,6 +1452,23 @@ bool EncModeCtrlMTnoRQT::tryMode( const EncTestMode& encTestmode, const CodingSt
     return false;
   }
 
+
+  
+  // Modification: Only square CUs
+  if (partitioner.currArea().lumaSize().width != partitioner.currArea().lumaSize().height)
+  {
+    return false;
+  }
+
+  // Modification: Only square CUs
+  if (partitioner.currArea().lumaSize().width > 32 && partitioner.currArea().lumaSize().height > 32)
+  {
+    return encTestmode.type == ETM_SPLIT_QT;
+  }
+    
+
+  
+
   const PartSplit implicitSplit = partitioner.getImplicitSplit( cs );
   const bool isBoundary         = implicitSplit != CU_DONT_SPLIT;
 
diff --git a/source/Lib/EncoderLib/IntraSearch.cpp b/source/Lib/EncoderLib/IntraSearch.cpp
index 1169828..0dc32d4 100644
--- a/source/Lib/EncoderLib/IntraSearch.cpp
+++ b/source/Lib/EncoderLib/IntraSearch.cpp
@@ -1418,10 +1418,21 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
         {
           continue;
         }
+#if NN_CHROMA_PRED_SIGNAL
+        if ((mode == LM_CHROMA_IDX) || (mode == LM_CHROMA_NN) || (mode == PLANAR_IDX) || (mode == DM_CHROMA_IDX)) // only pre-check regular modes and MDLM modes, not including DM ,Planar, and LM
+#else
         if ((mode == LM_CHROMA_IDX) || (mode == PLANAR_IDX) || (mode == DM_CHROMA_IDX)) // only pre-check regular modes and MDLM modes, not including DM ,Planar, and LM
+#endif
+        {
+          continue;
+        }
+
+#if NN_CHROMA_PRED_SIGNAL_REPLACE_TL
+        if ((mode == MDLM_L_IDX || mode == MDLM_T_IDX) && PU::isLMCNNenabled(pu))
         {
           continue;
         }
+#endif
         pu.intraDir[1] = mode; // temporary assigned, for SATD checking.
 
 #if JVET_P0058_CHROMA_TS_ENCODER_INTRA_SAD_MOD
@@ -1438,6 +1449,41 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
         CompArea areaCb = pu.Cb();
         PelBuf orgCb = cs.getOrgBuf(areaCb);
         PelBuf predCb = cs.getPredBuf(areaCb);
+        CompArea areaCr = pu.Cr();
+        PelBuf orgCr = cs.getOrgBuf(areaCr);
+        PelBuf predCr = cs.getPredBuf(areaCr);
+
+        if (PU::isLMCMode(mode))
+        {
+          
+#if NN_CHROMA_PRED
+          // Apply NN Intra Chroma prediction only for 8x8 blocks
+#if NN_CHROMA_PRED_SIGNAL
+          if (mode == LM_CHROMA_NN)
+#else
+          if (((areaCb.width == 4 && areaCb.height == 4) || (areaCb.width == 8 && areaCb.height == 8) || (areaCb.width == 16 && areaCb.height == 16)) && mode == LM_CHROMA_IDX)
+#endif
+          {
+            initNNIntraChroma(pu, areaCr);
+            predIntraNN(predCb, predCr, pu, COMPONENT_Y, pu.cs->slice->clpRng(COMPONENT_Cb));
+          }
+          else
+          {
+            predIntraChromaLM(COMPONENT_Cb, predCb, pu, areaCb, mode);
+            predIntraChromaLM(COMPONENT_Cr, predCr, pu, areaCr, mode);
+          }
+#else
+          predIntraChromaLM(COMPONENT_Cb, predCb, pu, areaCb, mode);
+          predIntraChromaLM(COMPONENT_Cr, predCr, pu, areaCr, mode);
+#endif
+        }
+        else
+        {
+          initPredIntraParams(pu, pu.Cb(), *pu.cs->sps);
+          predIntraAng(COMPONENT_Cb, predCb, pu);
+          initPredIntraParams(pu, pu.Cr(), *pu.cs->sps);
+          predIntraAng(COMPONENT_Cr, predCr, pu);
+        }
 #if JVET_P0058_CHROMA_TS_ENCODER_INTRA_SAD_MOD
         m_pcRdCost->setDistParam(distParamSad, orgCb, predCb, pu.cs->sps->getBitDepth(CHANNEL_TYPE_CHROMA), COMPONENT_Cb, false);
         m_pcRdCost->setDistParam(distParamSatd, orgCb, predCb, pu.cs->sps->getBitDepth(CHANNEL_TYPE_CHROMA), COMPONENT_Cb, true);
@@ -1450,15 +1496,6 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
 #else
         distParam.applyWeight = false;
 #endif
-        if (PU::isLMCMode(mode))
-        {
-          predIntraChromaLM(COMPONENT_Cb, predCb, pu, areaCb, mode);
-        }
-        else
-        {
-          initPredIntraParams(pu, pu.Cb(), *pu.cs->sps);
-          predIntraAng(COMPONENT_Cb, predCb, pu);
-        }
 #if JVET_P0058_CHROMA_TS_ENCODER_INTRA_SAD_MOD
         sadCb = distParamSad.distFunc(distParamSad) * 2;
         satdCb = distParamSatd.distFunc(distParamSatd);
@@ -1466,9 +1503,6 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
 #else
         sad += distParam.distFunc(distParam);
 #endif
-        CompArea areaCr = pu.Cr();
-        PelBuf orgCr = cs.getOrgBuf(areaCr);
-        PelBuf predCr = cs.getPredBuf(areaCr);
 #if JVET_P0058_CHROMA_TS_ENCODER_INTRA_SAD_MOD
         m_pcRdCost->setDistParam(distParamSad, orgCr, predCr, pu.cs->sps->getBitDepth(CHANNEL_TYPE_CHROMA), COMPONENT_Cr, false);
         m_pcRdCost->setDistParam(distParamSatd, orgCr, predCr, pu.cs->sps->getBitDepth(CHANNEL_TYPE_CHROMA), COMPONENT_Cr, true);
@@ -1481,15 +1515,6 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
 #else
         distParam.applyWeight = false;
 #endif
-        if (PU::isLMCMode(mode))
-        {
-          predIntraChromaLM(COMPONENT_Cr, predCr, pu, areaCr, mode);
-        }
-        else
-        {
-          initPredIntraParams(pu, pu.Cr(), *pu.cs->sps);
-          predIntraAng(COMPONENT_Cr, predCr, pu);
-        }
 #if JVET_P0058_CHROMA_TS_ENCODER_INTRA_SAD_MOD
         sadCr = distParamSad.distFunc(distParamSad) * 2;
         satdCr = distParamSatd.distFunc(distParamSatd);
@@ -1559,6 +1584,19 @@ void IntraSearch::estIntraPredChromaQT( CodingUnit &cu, Partitioner &partitioner
         {
           continue;
         }
+#if NN_CHROMA_PRED_SIGNAL
+        if (chromaIntraMode == LM_CHROMA_NN && !PU::isLMCNNenabled(pu))
+        {
+          continue;
+        }
+
+#if NN_CHROMA_PRED_SIGNAL_REPLACE_TL
+        if ((chromaIntraMode == MDLM_L_IDX || chromaIntraMode == MDLM_T_IDX) && PU::isLMCNNenabled(pu))
+        {
+          continue;
+        }
+#endif
+#endif
 #if JVET_P0059_CHROMA_BDPCM
         }
 #endif
@@ -3242,9 +3280,27 @@ void IntraSearch::xIntraCodingTUBlock(TransformUnit &tu, const ComponentID &comp
 #endif
     {
       {
+        initIntraPatternChType(*tu.cu, tu.blocks[COMPONENT_Cr]);
         xGetLumaRecPixels( pu, area );
       }
+#if NN_CHROMA_PRED
+      // Apply NN Intra Chroma prediction only for 8x8 blocks
+#if NN_CHROMA_PRED_SIGNAL
+      if(uiChFinalMode == LM_CHROMA_NN)
+#else
+      if (((area.width == 4 && area.height == 4) || (area.width == 8 && area.height == 8) || (area.width == 16 && area.height == 16)) && uiChFinalMode == LM_CHROMA_IDX)
+#endif
+      {
+        initNNIntraChroma(pu, area);
+        predIntraNN(piPred, piPred, pu, compID, pu.cs->slice->clpRng(compID));
+      }
+      else
+      {
+        predIntraChromaLM(compID, piPred, pu, area, uiChFinalMode);
+      }
+#else
       predIntraChromaLM( compID, piPred, pu, area, uiChFinalMode );
+#endif
     }
     else
     {
@@ -4312,16 +4368,39 @@ ChromaCbfs IntraSearch::xRecurIntraChromaCodingQT( CodingStructure &cs, Partitio
 
     if( PU::isLMCMode( predMode ) )
     {
-      xGetLumaRecPixels( pu, cbArea );
-      predIntraChromaLM( COMPONENT_Cb, piPredCb, pu, cbArea, predMode );
-      predIntraChromaLM( COMPONENT_Cr, piPredCr, pu, crArea, predMode );
+      xGetLumaRecPixels(pu, cbArea);
+#if NN_CHROMA_PRED
+      // Apply NN Intra Chroma prediction only for 8x8 blocks
+#if NN_CHROMA_PRED_SIGNAL
+      if (predMode == LM_CHROMA_NN)
+#else
+      if (((cbArea.width == 4 && cbArea.height == 4) || (cbArea.width == 8 && cbArea.height == 8) || (cbArea.width == 16 && cbArea.height == 16)) && predMode == LM_CHROMA_IDX)
+#endif
+      {
+        initNNIntraChroma(pu, crArea);
+        predIntraNN(piPredCb, piPredCr, pu, COMPONENT_Y, pu.cs->slice->clpRng(COMPONENT_Cb));
+      }
+      else
+      {
+        predIntraChromaLM(COMPONENT_Cb, piPredCb, pu, cbArea, predMode);
+        predIntraChromaLM(COMPONENT_Cr, piPredCr, pu, crArea, predMode);
+      }
     }
     else
     {
-      predIntraAng( COMPONENT_Cb, piPredCb, pu);
-      predIntraAng( COMPONENT_Cr, piPredCr, pu);
+      predIntraAng(COMPONENT_Cb, piPredCb, pu);
+      predIntraAng(COMPONENT_Cr, piPredCr, pu);
     }
-
+#else
+      predIntraChromaLM(COMPONENT_Cb, piPredCb, pu, cbArea, predMode);
+      predIntraChromaLM(COMPONENT_Cr, piPredCr, pu, crArea, predMode);
+    }
+    else
+    {
+      predIntraAng(COMPONENT_Cb, piPredCb, pu);
+      predIntraAng(COMPONENT_Cr, piPredCr, pu);
+    }
+#endif
     // determination of chroma residuals including reshaping and cross-component prediction
     //----- get chroma residuals -----
     PelBuf resiCb  = cs.getResiBuf(cbArea);
